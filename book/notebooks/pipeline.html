<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Guide de pratique pour Label Studio" href="labelstudio.html" /><link rel="prev" title="Mémoire digitale: les enjeux de l’archive numérique et du Big Data" href="../markdown/memoire.html" />

    <!-- Generated with Sphinx 5.0.2 and Furo 2023.03.27 -->
        <title>Pipeline de collecte des données - Intership CESR 23</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/vue/fonts.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Intership CESR 23</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo-gallica.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Intership CESR 23</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Rapport et mémoire</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../markdown/documentation.html">Les enjeux dans le développement d’un jeu de données autour des fonds numérisés de la Bibliothèque Nationale de France</a></li>
<li class="toctree-l1"><a class="reference internal" href="../markdown/memoire.html">Mémoire digitale: les enjeux de l’archive numérique et du Big Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Pipeline de collecte des données</a></li>
<li class="toctree-l1"><a class="reference internal" href="labelstudio.html">Guide de pratique pour Label Studio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../markdown/bibliography.html">Références</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="pipeline-de-collecte-des-donnees">
<h1>Pipeline de collecte des données<a class="headerlink" href="#pipeline-de-collecte-des-donnees" title="Permalink to this heading">#</a></h1>
<p>Le projet <a class="reference external" href="https://gallica.bnf.fr/accueil/fr/content/accueil-fr?mode=desktop">Gallica Images</a> (2023-2026), qui à agréger et à indexer (à
l’aide de briques IA) les contenus iconographiques de Gallica sous la forme d’une base de
données publique dotée d’un moteur de recherche. Une des sources d’inspiration de ce
projet est le démonstrateur <a class="reference external" href="https://gallica.bnf.fr/blog/21062021/gallicapix-un-nouvel-outil-dexploration-iconographique?mode=desktop">GallicaPix</a>.</p>
<p>Ce stage s’inscrit dans la phase de sélection du partenaire industriel chargé des
développements informatiques et dans celle de la préparation du lancement du projet (été
2023). Il aura pour objet la conception et le développement d’un banc de test du pipeline de
traitement d’images qui sera produit par le partenaire industriel lors de l’année 1 du projet,
consacrée à la réalisation d’un MVP (minimum viable product) portant sur la collection Images de Gallica.
Ce banc de test servira à l’évaluation des performances du pipeline ainsi
qu’à sa recette finale.</p>
<p>Ce notebook a pour objectif la démonstration des différentes étapes du pipeline de l’entrepôt: de la collecte des métadonnées présent dans l’entrepôt OAINUM à la récupération des différentes images présent dans Gallica Images à travers le protocole IIIF.</p>
<div class="dropdown admonition warning">
<p class="admonition-title">Warning</p>
<p>Ce jupyter est automatiquement chargé avec les modules et packages compris. Pour lancer le notebook localement, vous devez installer les packages requis.
<a class="reference download internal" download="" href="../../_downloads/7acc9b5b69931a8bf3be50f698352075/pipeline.zip"><span class="xref download myst">Téléchargement</span></a></p>
</div>
<section id="les-entrepots-de-la-bnf">
<h2>Les entrepôts de la BnF<a class="headerlink" href="#les-entrepots-de-la-bnf" title="Permalink to this heading">#</a></h2>
<p>La BnF gère deux types d’entrepôts OAI-NUM et OAI-CAT où sont stockés l’ensemble des métadonnées relatives à ses documents.</p>
<p>Le premier entrepôt OAI-NUM de données correspond aux notices des documents numériques dont la consultation est ouverte à tout public. Un sous-ensemble important de ces notices est consultable via Gallica en particulier. Cet entrepôt contient l’ensemble des notices des documents numériques consultables dans Gallica et pour lesquels la BnF possède les fichiers numériques. La granularité de cet entrepôt est le document numérique « unitaire », tel que consulté dans Gallica : un document numérique consultable identifié par un identifiant ark unique, un enregistrement (« record »).</p>
<p>Son interrogation permet d’obtenir les métadonnées d’un document numérique dont l’identifiant ark a par exemple été trouvé dans Gallica. Il est également possible d’obtenir une liste d’identifiants de documents appartenant à un ensemble prédéfini dans l’entrepôt (appelé « set » dans la terminologie OAI).</p>
<div class="literal-block-wrapper docutils container" id="setsxml">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text">Extrait XML de la requête <a class="reference external" href="http://oai.bnf.fr/oai2//OAIHandler?verb=ListSets">ListSets</a> qui liste l’ensemble des sets présents dans l’entrepôt</span><a class="headerlink" href="#setsxml" title="Permalink to this code">#</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;set&gt;</span>
<span class="nt">&lt;setSpec&gt;</span>gallica:typedoc:periodiques<span class="nt">&lt;/setSpec&gt;</span>
<span class="nt">&lt;setName&gt;</span>Gallica<span class="w"> </span>:<span class="w"> </span>types<span class="w"> </span>de<span class="w"> </span>documents<span class="w"> </span>:<span class="w"> </span>périodiques<span class="w"> </span>imprimés<span class="nt">&lt;/setName&gt;</span>
<span class="nt">&lt;setDescription&gt;</span>
<span class="nt">&lt;oai_dc:dc</span><span class="w"> </span><span class="na">xmlns:oai_dc=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc/&quot;</span><span class="w"> </span><span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc/ http://www.openarchives.org/OAI/2.0/oai_dc.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;dc:description</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;fre&quot;</span><span class="nt">&gt;</span>Cet<span class="w"> </span>ensemble<span class="w"> </span>donne<span class="w"> </span>accès<span class="w"> </span>aux<span class="w"> </span>journaux,<span class="w"> </span>revues<span class="w"> </span>et<span class="w"> </span>autres<span class="w"> </span>publications<span class="w"> </span>périodiques<span class="w"> </span>imprimées<span class="w"> </span>de<span class="w"> </span>Gallica.<span class="nt">&lt;/dc:description&gt;</span>
<span class="nt">&lt;dc:description</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>This<span class="w"> </span>set<span class="w"> </span>provides<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>printed<span class="w"> </span>press,<span class="w"> </span>journals<span class="w"> </span>and<span class="w"> </span>serials<span class="w"> </span>in<span class="w"> </span>Gallica.<span class="nt">&lt;/dc:description&gt;</span>
<span class="nt">&lt;/oai_dc:dc&gt;</span>
<span class="nt">&lt;/setDescription&gt;</span>
<span class="nt">&lt;/set&gt;</span>
</pre></div>
</div>
</div>
<div class="dropdown admonition note">
<p class="admonition-title">Note</p>
<p>L’arborescence des sets et analogue aux dossiers et sous-dossiers, dans l’exemple ci-dessus gallica est le le dossier racine et périodiques le dossier enfant de typedoc qui lui-même le dossier enfant de gallica.<br />
Cela permet de récupérer des ensembles de records disposant d’un parent commun.</p>
</div>
<section id="la-collecte-de-metadonnees-a-travers-oai-py">
<h3>La collecte de métadonnées à travers <code class="docutils literal notranslate"><span class="pre">oai.py</span></code><a class="headerlink" href="#la-collecte-de-metadonnees-a-travers-oai-py" title="Permalink to this heading">#</a></h3>
<div class="cell tag_command_line docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>modules/requirements.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modules.oai</span> <span class="kn">import</span> <span class="n">OAINUM</span>
<span class="kn">from</span> <span class="nn">fnmatch</span> <span class="kn">import</span> <span class="n">fnmatch</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Créer une instance `gallica` et récupère l&#39;ensemble des sets présents à l&#39;intérieur de l&#39;entrepôt</span>
<span class="n">gallica</span> <span class="o">=</span> <span class="n">OAINUM</span><span class="p">(</span><span class="s1">&#39;http://oai.bnf.fr/oai2//OAIHandler&#39;</span><span class="p">)</span>
<span class="n">setspec</span><span class="p">,</span><span class="n">setname</span> <span class="o">=</span> <span class="n">gallica</span><span class="o">.</span><span class="n">listSets</span>
<span class="nb">len</span><span class="p">(</span><span class="n">setspec</span><span class="p">),</span><span class="n">setspec</span><span class="p">[</span><span class="mi">250</span><span class="p">],</span> <span class="n">setname</span><span class="p">[</span><span class="mi">250</span><span class="p">]</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(547, &#39;gallica:corpus:BNUStr059&#39;, &#39;Presse satirique alsacienne&#39;)
</pre></div>
</div>
</div>
</details>
</div>
<p>Il est également possible de récupérer les métadonnées associées à  des documents si on dispose de leur <a class="reference external" href="https://www.bnf.fr/fr/lidentifiant-ark-archival-resource-key">ARK</a>.Par défaut le type de format est le format <strong>Dublin Core Simple</strong> <em>oai_dc</em> mais il est également possible de récupérer le format <strong>TEL-Application profile</strong> <em>tel_ap</em>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gallica</span><span class="o">.</span><span class="n">getRecord</span><span class="p">(</span><span class="s1">&#39;btv1b6937398m&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;title&#39;: [&#39;[Estampes du recueil de costumes étrangers formé par M. de Gaignières, faisant suite aux costumes de france - Contrées du Nord - 1296 à 1577] : [estampe]&#39;],
 &#39;creator&#39;: [],
 &#39;subject&#39;: [&#39;Costume -- Écosse (GB)&#39;],
 &#39;description&#39;: [&#39;Collectionneur : Gaignières, Roger de (1642-1715). Collectionneur&#39;],
 &#39;publisher&#39;: [],
 &#39;contributor&#39;: [],
 &#39;relation&#39;: [&#39;Notice de recueil : http://catalogue.bnf.fr/ark:/12148/cb40356863k&#39;,
  &#39;Appartient à : Recueil de costumes étrangers formé par M. de Gaignières, faisant suite aux costumes de france - Contrées du Nord - 1296 à 1577&#39;,
  &#39;Notice du catalogue : http://catalogue.bnf.fr/ark:/12148/cb412591740&#39;],
 &#39;coverage&#39;: [],
 &#39;identifier&#39;: [&#39;http://gallica.bnf.fr/ark:/12148/btv1b6937398m&#39;],
 &#39;rights&#39;: [&#39;domaine public&#39;],
 &#39;type&#39;: [&#39;image fixe&#39;, &#39;estampe&#39;],
 &#39;language&#39;: [],
 &#39;date&#39;: [&#39;1600&#39;],
 &#39;format&#39;: [&#39;35 gravures coloriées ; formats divers&#39;,
  &#39;image/jpeg&#39;,
  &#39;Nombre total de vues :  36&#39;],
 &#39;source&#39;: [&#39;Bibliothèque nationale de France, département Estampes et photographie, BnF, Es. RESERVE OB-112-Fo&#39;]}
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gallica</span><span class="o">.</span><span class="n">getRecord</span><span class="p">(</span><span class="s1">&#39;btv1b6937398m&#39;</span><span class="p">,</span><span class="n">metadata</span><span class="o">=</span><span class="s1">&#39;tel_ap&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;identifier&#39;: [&#39;http://gallica.bnf.fr/ark:/12148/btv1b6937398m/texteBrut&#39;],
 &#39;title&#39;: [&#39;[Estampes du recueil de costumes étrangers formé par M. de Gaignières, faisant suite aux costumes de france - Contrées du Nord - 1296 à 1577] : [estampe]&#39;],
 &#39;alternativecontributor&#39;: [],
 &#39;subject&#39;: [&#39;Costume -- Écosse (GB)&#39;],
 &#39;description&#39;: [&quot;Gravures insérées par R. de Gaignières dans l&#39;album de dessins de costumes (p. 1-12, 20, 25-45, 47, 49)&quot;,
  &#39;Après la page de titre, page manuscrite : &quot;Table du XXe volume - Modes d\&#39;Angleterre depuis 1296 jusqu\&#39;en 1577 ; modes d\&#39;Ecosse ; modes de Suède et de Laponie ; modes de Hongrie, modes de la Moscovie ; Modes de la Pologne et de la Prusse -N° 1461&#39;],
 &#39;typeOfResource&#39;: [&#39;still image&#39;],
 &#39;type&#39;: [&#39;Still image&#39;],
 &#39;extent&#39;: [&#39;35 gravures coloriées&#39;],
 &#39;bibliographicCitation&#39;: [&#39;[Estampes du recueil de costumes étrangers formé par M. de Gaignières, faisant suite aux costumes de france - Contrées du Nord - 1296 à 1577] : [estampe]. [1600]&#39;],
 &#39;date&#39;: [&#39;009&#39;],
 &#39;format&#39;: [&#39;image/jpeg&#39;],
 &#39;source&#39;: [&#39;Bibliothèque nationale de France, département Estampes et photographie, BnF, Es. RESERVE OB-112-Fo&#39;],
 &#39;location&#39;: [&#39;Bibliothèque nationale de France&#39;, &#39;751131015&#39;],
 &#39;isFormatOf&#39;: [&#39;http://catalogue.bnf.fr/ark:/12148/btv1b6937398m&#39;],
 &#39;seeOnline&#39;: [&#39;http://gallica.bnf.fr/ark:/12148/btv1b6937398m&#39;],
 &#39;fullText&#39;: [&#39;http://gallica.bnf.fr/ark:/12148/btv1b6937398m/texteBrut&#39;]}
</pre></div>
</div>
</div>
</details>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>La BnF dipose de trois types de format de métadonnées dans l’entrepôt OAINUM:</p>
<ol class="arabic simple">
<li><p><strong>Dublin Cores Simple (oai_dc)</strong> : les principes retenus à la BnF dans l’utilisation des éléments du Dublin Core simple sont présentés dans le <a class="reference external" href="https://multimedia-ext.bnf.fr/pdf/guide_dublin_core_bnf_2008.pdf">Guide d’utilisation du Dublin Core à la BnF</a>.</p></li>
<li><p><strong>TEL-Application profile (tel_ap)</strong> : il s’agit d’un profil d’application du Dublin Core spécifiquement développé dans le cadre du projet européen The European Library. En plus des éléments du Dublin Core simple, le TEL – Application profile utilise quelques éléments du Dublin Code qualifié (ex. dcterms:issued), de MODS (ex. mods:location), et quelques éléments spécifiques à TEL-AP pour préciser le lien aux ressources numérisées lorsque c’est pertinent (tel:seeonline vers la ressource numérisée, et tel:fulltext vers le texte OCRisé).</p></li>
<li><p><strong>MPEG21-DIDL (didl)</strong> : utile en particulier pour la représentation de la granularité des objets numériques (fascicules de périodiques, légendes des photographies dans un album). À l’intérieur de la structure DIDL, le format choisi est le Dublin Core simple.</p></li>
</ol>
</div>
</section>
<section id="creation-d-un-parser">
<h3>Création d’un <em>parser</em><a class="headerlink" href="#creation-d-un-parser" title="Permalink to this heading">#</a></h3>
<p>L’instance <code class="docutils literal notranslate"><span class="pre">gallica</span></code> dispose seulement de l’implémentation du format <code class="docutils literal notranslate"><span class="pre">oai_dc</span></code> et <code class="docutils literal notranslate"><span class="pre">tel_ap</span></code> avec des <em>parser</em> par défaut. Il existe la possibilité de créer son propre parser notamment pour le format de métadonnées <code class="docutils literal notranslate"><span class="pre">didl</span></code> qui n’est pour lors pas implémenté.</p>
<p>Le <em>parser</em> extrait seulement les balises et éléments enfants de <code class="docutils literal notranslate"><span class="pre">&lt;metadata&gt;</span></code>. Pour implémenter soi-même son propre parseur, il est nécessaire de créer un dictionnaire python qui comprend trois clés <code class="docutils literal notranslate"><span class="pre">fields</span></code>, <code class="docutils literal notranslate"><span class="pre">namespaces</span></code>, <code class="docutils literal notranslate"><span class="pre">prefix</span></code>, le premier étant le chemin <a class="reference external" href="https://fr.wikipedia.org/wiki/XPath">XPath</a> de la donnée à extraire, le second étant l’ensemble des <a class="reference external" href="https://en.wikipedia.org/wiki/XML_namespace">namespaces</a> nécessaire, ainsi que le préfixe obligatoire lors de la requête désignant un des trois type de format de métadonnées disponible dans l’entrepôt.</p>
<p>Un exemple pour la <a class="reference external" href="http://oai.bnf.fr/oai2//OAIHandler?verb=GetRecord&amp;identifier=oai:bnf.fr:gallica/ark:/12148/bpt6k5499065k&amp;metadataPrefix=didl">requête</a> concernant le document <code class="docutils literal notranslate"><span class="pre">ark</span></code>: <a class="reference external" href="https://gallica.bnf.fr/ark:/12148/bpt6k5499065k">bpt6k5499065k</a> <code class="docutils literal notranslate"><span class="pre">prefix</span></code>: <a class="reference external" href="https://fr.wikipedia.org/wiki/MPEG-21">DIDL</a>:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
METADATA</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="metadataxml">
<div class="code-block-caption"><span class="caption-number">Listing 2 </span><span class="caption-text">Extrait XML des élements enfants de &lt;metadata&gt;</span><a class="headerlink" href="#metadataxml" title="Permalink to this code">#</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos"> 1</span><span class="nt">&lt;metadata&gt;</span>
</span><span class="linenos"> 2</span><span class="nt">&lt;didl:DIDL</span><span class="w"> </span><span class="na">xmlns:didl=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:02-DIDL-NS&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:02-DIDL-NS http://standards.iso.org/ittf/PubliclyAvailableStandards/MPEG-21_schema_files/did/didl.xsd&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 3</span><span class="nt">&lt;didl:Item&gt;</span>
<span class="linenos"> 4</span><span class="nt">&lt;didl:Descriptor&gt;</span>
<span class="linenos"> 5</span><span class="nt">&lt;didl:Statement</span><span class="w"> </span><span class="na">mimeType=</span><span class="s">&quot;text/xml; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 6</span><span class="nt">&lt;dii:Identifier</span><span class="w"> </span><span class="na">xmlns:dii=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:01-DII-NS&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:01-DII-NS http://standards.iso.org/ittf/PubliclyAvailableStandards/MPEG-21_schema_files/dii/dii.xsd&quot;</span><span class="nt">&gt;</span>http://gallica.bnf.fr/ark:/12148/bpt6k5499065k<span class="nt">&lt;/dii:Identifier&gt;</span>
<span class="linenos"> 7</span><span class="nt">&lt;/didl:Statement&gt;</span>
<span class="linenos"> 8</span><span class="nt">&lt;/didl:Descriptor&gt;</span>
<span class="linenos"> 9</span><span class="nt">&lt;didl:Descriptor&gt;</span>
<span class="linenos">10</span><span class="nt">&lt;didl:Statement</span><span class="w"> </span><span class="na">mimeType=</span><span class="s">&quot;text/xml; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="linenos">11</span><span class="nt">&lt;oai_dc:dc</span><span class="w"> </span><span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span><span class="w"> </span><span class="na">xmlns:oai_dc=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc/&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc/ http://www.openarchives.org/OAI/2.0/oai_dc.xsd&quot;</span><span class="nt">&gt;</span>
<span class="linenos">12</span><span class="nt">&lt;dc:identifier&gt;</span>http://gallica.bnf.fr/ark:/12148/bpt6k5499065k<span class="nt">&lt;/dc:identifier&gt;</span>
<span class="linenos">13</span><span class="nt">&lt;dc:title&gt;</span>Cour<span class="w"> </span>de<span class="w"> </span>cassation<span class="w"> </span>de<span class="w"> </span>Leipzig.<span class="w"> </span>Affaire<span class="w"> </span>de<span class="w"> </span>la<span class="w"> </span>réunion<span class="w"> </span>alsacienne<span class="w"> </span>de<span class="w"> </span>Mulhouse.<span class="w"> </span>Prévention<span class="w"> </span>d&#39;association<span class="w"> </span>autorisée.<span class="w"> </span>Mémoire<span class="w"> </span>à<span class="w"> </span>consulter.<span class="w"> </span>Consultation.<span class="w"> </span>[Par<span class="w"> </span>J.-F.<span class="w"> </span>Dupont<span class="w"> </span>(de<span class="w"> </span>Bussac).]<span class="nt">&lt;/dc:title&gt;</span>
<span class="linenos">14</span><span class="nt">&lt;dc:creator&gt;</span>Dupont<span class="w"> </span>de<span class="w"> </span>Bussac,<span class="w"> </span>Jacques<span class="w"> </span>François<span class="w"> </span>(1803-1873).<span class="w"> </span>Auteur<span class="w"> </span>du<span class="w"> </span>texte<span class="nt">&lt;/dc:creator&gt;</span>
<span class="linenos">15</span><span class="nt">&lt;dc:contributor&gt;</span>Cour<span class="w"> </span>de<span class="w"> </span>cassation<span class="w"> </span>de<span class="w"> </span>Leipzig.<span class="w"> </span>Éditeur<span class="w"> </span>scientifique<span class="nt">&lt;/dc:contributor&gt;</span>
<span class="linenos">16</span><span class="nt">&lt;dc:publisher&gt;</span>impr.<span class="w"> </span>de<span class="w"> </span>Barthier<span class="w"> </span>(Paris)<span class="nt">&lt;/dc:publisher&gt;</span>
<span class="linenos">17</span><span class="nt">&lt;dc:date&gt;</span>1873<span class="nt">&lt;/dc:date&gt;</span>
<span class="linenos">18</span><span class="nt">&lt;dc:format&gt;</span>Gr.<span class="w"> </span>in-8°<span class="w"> </span>,<span class="w"> </span>51<span class="w"> </span>p.<span class="nt">&lt;/dc:format&gt;</span>
<span class="linenos">19</span><span class="nt">&lt;dc:language&gt;</span>fre<span class="nt">&lt;/dc:language&gt;</span>
<span class="linenos">20</span><span class="nt">&lt;dc:language&gt;</span>français<span class="nt">&lt;/dc:language&gt;</span>
<span class="linenos">21</span><span class="nt">&lt;dc:relation&gt;</span>Notice<span class="w"> </span>du<span class="w"> </span>catalogue<span class="w"> </span>:<span class="w"> </span>http://catalogue.bnf.fr/ark:/12148/cb303815454<span class="nt">&lt;/dc:relation&gt;</span>
<span class="linenos">22</span><span class="nt">&lt;dc:type</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>text<span class="nt">&lt;/dc:type&gt;</span>
<span class="linenos">23</span><span class="nt">&lt;dc:type</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;fre&quot;</span><span class="nt">&gt;</span>monographie<span class="w"> </span>imprimée<span class="nt">&lt;/dc:type&gt;</span>
<span class="linenos">24</span><span class="nt">&lt;dc:type</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>monographie<span class="w"> </span>imprimée<span class="nt">&lt;/dc:type&gt;</span>
<span class="linenos">25</span><span class="nt">&lt;dc:source&gt;</span>Bibliothèque<span class="w"> </span>nationale<span class="w"> </span>de<span class="w"> </span>France,<span class="w"> </span>département<span class="w"> </span>Philosophie,<span class="w"> </span>histoire,<span class="w"> </span>sciences<span class="w"> </span>de<span class="w"> </span>l&#39;homme,<span class="w"> </span>4-LB57-4383<span class="nt">&lt;/dc:source&gt;</span>
<span class="linenos">26</span><span class="nt">&lt;dc:rights</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;fre&quot;</span><span class="nt">&gt;</span>domaine<span class="w"> </span>public<span class="nt">&lt;/dc:rights&gt;</span>
<span class="linenos">27</span><span class="nt">&lt;dc:rights</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>public<span class="w"> </span>domain<span class="nt">&lt;/dc:rights&gt;</span>
<span class="linenos">28</span><span class="nt">&lt;dc:description&gt;</span>Appartient<span class="w"> </span>à<span class="w"> </span>l’ensemble<span class="w"> </span>documentaire<span class="w"> </span>:<span class="w"> </span>Alsace1<span class="nt">&lt;/dc:description&gt;</span>
<span class="linenos">29</span><span class="nt">&lt;dc:format&gt;</span>Nombre<span class="w"> </span>total<span class="w"> </span>de<span class="w"> </span>vues<span class="w"> </span>:<span class="w"> </span>56<span class="nt">&lt;/dc:format&gt;</span>
<span class="linenos">30</span><span class="nt">&lt;dc:description&gt;</span>Avec<span class="w"> </span>mode<span class="w"> </span>texte<span class="nt">&lt;/dc:description&gt;</span>
<span class="linenos">31</span><span class="nt">&lt;/oai_dc:dc&gt;</span>
<span class="linenos">32</span><span class="nt">&lt;/didl:Statement&gt;</span>
<span class="linenos">33</span><span class="nt">&lt;/didl:Descriptor&gt;</span>
<span class="linenos">34</span><span class="nt">&lt;didl:Component&gt;</span>
<span class="linenos">35</span><span class="nt">&lt;didl:Resource</span><span class="w"> </span><span class="na">mimeType=</span><span class="s">&quot;application/pdf&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;http://gallica.bnf.fr/ark:/12148/bpt6k5499065k&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">36</span><span class="nt">&lt;/didl:Component&gt;</span>
<span class="linenos">37</span><span class="nt">&lt;/didl:Item&gt;</span>
<span class="linenos">38</span><span class="nt">&lt;/didl:DIDL&gt;</span>
<span class="hll"><span class="linenos">39</span><span class="nt">&lt;/metadata&gt;</span>
</span></pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
XML (Tree)</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="xmltreeoai">
<div class="code-block-caption"><span class="caption-number">Listing 3 </span><span class="caption-text">L’ensemble de l’arborescence XML</span><a class="headerlink" href="#xmltreeoai" title="Permalink to this code">#</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">&lt;OAI-PMH</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 2</span><span class="nt">&lt;responseDate&gt;</span>2023-06-05T09:34:20Z<span class="nt">&lt;/responseDate&gt;</span>
<span class="linenos"> 3</span><span class="nt">&lt;request</span><span class="w"> </span><span class="na">verb=</span><span class="s">&quot;GetRecord&quot;</span><span class="w"> </span><span class="na">identifier=</span><span class="s">&quot;oai:bnf.fr:gallica/ark:/12148/bpt6k5499065k&quot;</span><span class="w"> </span><span class="na">metadataPrefix=</span><span class="s">&quot;didl&quot;</span><span class="nt">&gt;</span>http://oai.bnf.fr/oai2//OAIHandler<span class="nt">&lt;/request&gt;</span>
<span class="linenos"> 4</span><span class="nt">&lt;GetRecord&gt;</span>
<span class="linenos"> 5</span><span class="nt">&lt;record&gt;</span>
<span class="linenos"> 6</span><span class="nt">&lt;header&gt;</span>
<span class="linenos"> 7</span><span class="nt">&lt;identifier&gt;</span>oai:bnf.fr:gallica/ark:/12148/bpt6k5499065k<span class="nt">&lt;/identifier&gt;</span>
<span class="linenos"> 8</span><span class="nt">&lt;datestamp&gt;</span>2018-04-26<span class="nt">&lt;/datestamp&gt;</span>
<span class="linenos"> 9</span><span class="nt">&lt;setSpec&gt;</span>gallica:corpus:Alsace1<span class="nt">&lt;/setSpec&gt;</span>
<span class="linenos">10</span><span class="nt">&lt;setSpec&gt;</span>gallica:theme:9:94<span class="nt">&lt;/setSpec&gt;</span>
<span class="linenos">11</span><span class="nt">&lt;setSpec&gt;</span>gallica:typedoc:monographies<span class="nt">&lt;/setSpec&gt;</span>
<span class="linenos">12</span><span class="nt">&lt;/header&gt;</span>
<span class="hll"><span class="linenos">13</span><span class="nt">&lt;metadata&gt;</span>
</span><span class="linenos">14</span><span class="nt">&lt;didl:DIDL</span><span class="w"> </span><span class="na">xmlns:didl=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:02-DIDL-NS&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:02-DIDL-NS http://standards.iso.org/ittf/PubliclyAvailableStandards/MPEG-21_schema_files/did/didl.xsd&quot;</span><span class="nt">&gt;</span>
<span class="linenos">15</span><span class="nt">&lt;didl:Item&gt;</span>
<span class="linenos">16</span><span class="nt">&lt;didl:Descriptor&gt;</span>
<span class="linenos">17</span><span class="nt">&lt;didl:Statement</span><span class="w"> </span><span class="na">mimeType=</span><span class="s">&quot;text/xml; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="linenos">18</span><span class="nt">&lt;dii:Identifier</span><span class="w"> </span><span class="na">xmlns:dii=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:01-DII-NS&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;urn:mpeg:mpeg21:2002:01-DII-NS http://standards.iso.org/ittf/PubliclyAvailableStandards/MPEG-21_schema_files/dii/dii.xsd&quot;</span><span class="nt">&gt;</span>http://gallica.bnf.fr/ark:/12148/bpt6k5499065k<span class="nt">&lt;/dii:Identifier&gt;</span>
<span class="linenos">19</span><span class="nt">&lt;/didl:Statement&gt;</span>
<span class="linenos">20</span><span class="nt">&lt;/didl:Descriptor&gt;</span>
<span class="linenos">21</span><span class="nt">&lt;didl:Descriptor&gt;</span>
<span class="linenos">22</span><span class="nt">&lt;didl:Statement</span><span class="w"> </span><span class="na">mimeType=</span><span class="s">&quot;text/xml; charset=UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="linenos">23</span><span class="nt">&lt;oai_dc:dc</span><span class="w"> </span><span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span><span class="w"> </span><span class="na">xmlns:oai_dc=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc/&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc/ http://www.openarchives.org/OAI/2.0/oai_dc.xsd&quot;</span><span class="nt">&gt;</span>
<span class="linenos">24</span><span class="nt">&lt;dc:identifier&gt;</span>http://gallica.bnf.fr/ark:/12148/bpt6k5499065k<span class="nt">&lt;/dc:identifier&gt;</span>
<span class="linenos">25</span><span class="nt">&lt;dc:title&gt;</span>Cour<span class="w"> </span>de<span class="w"> </span>cassation<span class="w"> </span>de<span class="w"> </span>Leipzig.<span class="w"> </span>Affaire<span class="w"> </span>de<span class="w"> </span>la<span class="w"> </span>réunion<span class="w"> </span>alsacienne<span class="w"> </span>de<span class="w"> </span>Mulhouse.<span class="w"> </span>Prévention<span class="w"> </span>d&#39;association<span class="w"> </span>autorisée.<span class="w"> </span>Mémoire<span class="w"> </span>à<span class="w"> </span>consulter.<span class="w"> </span>Consultation.<span class="w"> </span>[Par<span class="w"> </span>J.-F.<span class="w"> </span>Dupont<span class="w"> </span>(de<span class="w"> </span>Bussac).]<span class="nt">&lt;/dc:title&gt;</span>
<span class="linenos">26</span><span class="nt">&lt;dc:creator&gt;</span>Dupont<span class="w"> </span>de<span class="w"> </span>Bussac,<span class="w"> </span>Jacques<span class="w"> </span>François<span class="w"> </span>(1803-1873).<span class="w"> </span>Auteur<span class="w"> </span>du<span class="w"> </span>texte<span class="nt">&lt;/dc:creator&gt;</span>
<span class="linenos">27</span><span class="nt">&lt;dc:contributor&gt;</span>Cour<span class="w"> </span>de<span class="w"> </span>cassation<span class="w"> </span>de<span class="w"> </span>Leipzig.<span class="w"> </span>Éditeur<span class="w"> </span>scientifique<span class="nt">&lt;/dc:contributor&gt;</span>
<span class="linenos">28</span><span class="nt">&lt;dc:publisher&gt;</span>impr.<span class="w"> </span>de<span class="w"> </span>Barthier<span class="w"> </span>(Paris)<span class="nt">&lt;/dc:publisher&gt;</span>
<span class="linenos">29</span><span class="nt">&lt;dc:date&gt;</span>1873<span class="nt">&lt;/dc:date&gt;</span>
<span class="linenos">30</span><span class="nt">&lt;dc:format&gt;</span>Gr.<span class="w"> </span>in-8°<span class="w"> </span>,<span class="w"> </span>51<span class="w"> </span>p.<span class="nt">&lt;/dc:format&gt;</span>
<span class="linenos">31</span><span class="nt">&lt;dc:language&gt;</span>fre<span class="nt">&lt;/dc:language&gt;</span>
<span class="linenos">32</span><span class="nt">&lt;dc:language&gt;</span>français<span class="nt">&lt;/dc:language&gt;</span>
<span class="linenos">33</span><span class="nt">&lt;dc:relation&gt;</span>Notice<span class="w"> </span>du<span class="w"> </span>catalogue<span class="w"> </span>:<span class="w"> </span>http://catalogue.bnf.fr/ark:/12148/cb303815454<span class="nt">&lt;/dc:relation&gt;</span>
<span class="linenos">34</span><span class="nt">&lt;dc:type</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>text<span class="nt">&lt;/dc:type&gt;</span>
<span class="linenos">35</span><span class="nt">&lt;dc:type</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;fre&quot;</span><span class="nt">&gt;</span>monographie<span class="w"> </span>imprimée<span class="nt">&lt;/dc:type&gt;</span>
<span class="linenos">36</span><span class="nt">&lt;dc:type</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>monographie<span class="w"> </span>imprimée<span class="nt">&lt;/dc:type&gt;</span>
<span class="linenos">37</span><span class="nt">&lt;dc:source&gt;</span>Bibliothèque<span class="w"> </span>nationale<span class="w"> </span>de<span class="w"> </span>France,<span class="w"> </span>département<span class="w"> </span>Philosophie,<span class="w"> </span>histoire,<span class="w"> </span>sciences<span class="w"> </span>de<span class="w"> </span>l&#39;homme,<span class="w"> </span>4-LB57-4383<span class="nt">&lt;/dc:source&gt;</span>
<span class="linenos">38</span><span class="nt">&lt;dc:rights</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;fre&quot;</span><span class="nt">&gt;</span>domaine<span class="w"> </span>public<span class="nt">&lt;/dc:rights&gt;</span>
<span class="linenos">39</span><span class="nt">&lt;dc:rights</span><span class="w"> </span><span class="na">xml:lang=</span><span class="s">&quot;eng&quot;</span><span class="nt">&gt;</span>public<span class="w"> </span>domain<span class="nt">&lt;/dc:rights&gt;</span>
<span class="linenos">40</span><span class="nt">&lt;dc:description&gt;</span>Appartient<span class="w"> </span>à<span class="w"> </span>l’ensemble<span class="w"> </span>documentaire<span class="w"> </span>:<span class="w"> </span>Alsace1<span class="nt">&lt;/dc:description&gt;</span>
<span class="linenos">41</span><span class="nt">&lt;dc:format&gt;</span>Nombre<span class="w"> </span>total<span class="w"> </span>de<span class="w"> </span>vues<span class="w"> </span>:<span class="w"> </span>56<span class="nt">&lt;/dc:format&gt;</span>
<span class="linenos">42</span><span class="nt">&lt;dc:description&gt;</span>Avec<span class="w"> </span>mode<span class="w"> </span>texte<span class="nt">&lt;/dc:description&gt;</span>
<span class="linenos">43</span><span class="nt">&lt;/oai_dc:dc&gt;</span>
<span class="linenos">44</span><span class="nt">&lt;/didl:Statement&gt;</span>
<span class="linenos">45</span><span class="nt">&lt;/didl:Descriptor&gt;</span>
<span class="linenos">46</span><span class="nt">&lt;didl:Component&gt;</span>
<span class="linenos">47</span><span class="nt">&lt;didl:Resource</span><span class="w"> </span><span class="na">mimeType=</span><span class="s">&quot;application/pdf&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;http://gallica.bnf.fr/ark:/12148/bpt6k5499065k&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">48</span><span class="nt">&lt;/didl:Component&gt;</span>
<span class="linenos">49</span><span class="nt">&lt;/didl:Item&gt;</span>
<span class="linenos">50</span><span class="nt">&lt;/didl:DIDL&gt;</span>
<span class="hll"><span class="linenos">51</span><span class="nt">&lt;/metadata&gt;</span>
</span><span class="linenos">52</span><span class="nt">&lt;/record&gt;</span>
<span class="linenos">53</span><span class="nt">&lt;/GetRecord&gt;</span>
<span class="linenos">54</span><span class="nt">&lt;/OAI-PMH&gt;</span>
</pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-2" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
OAI_DC (default)</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="oaidcparser">
<div class="code-block-caption"><span class="caption-number">Listing 4 </span><span class="caption-text">Parser par défaut implémenter pour oai_dc</span><a class="headerlink" href="#oaidcparser" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="n">fields</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span>       <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:title/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;creator&#39;</span><span class="p">:</span>     <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:creator/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;subject&#39;</span><span class="p">:</span>     <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:subject/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:description/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;publisher&#39;</span><span class="p">:</span>   <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:publisher/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;contributor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:contributor/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;relation&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:relation/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;coverage&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:coverage/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;identifier&#39;</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:identifier/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;rights&#39;</span><span class="p">:</span>      <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:rights[@xml:lang=&quot;fre&quot;]/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span>        <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:type[@xml:lang=&quot;fre&quot;]/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;language&#39;</span><span class="p">:</span>    <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:language/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;date&#39;</span><span class="p">:</span>        <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:date/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;format&#39;</span><span class="p">:</span>      <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:format/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;source&#39;</span><span class="p">:</span>      <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;oai_dc:dc/dc:source/text()&#39;</span><span class="p">),},</span>
<span class="n">namespaces</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;oai_dc&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.openarchives.org/OAI/2.0/oai_dc/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dc&#39;</span> <span class="p">:</span> <span class="s1">&#39;http://purl.org/dc/elements/1.1/&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
TEL_AP (default)</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="telapparser">
<div class="code-block-caption"><span class="caption-number">Listing 5 </span><span class="caption-text">Parser par défaut implémenter pour tel_ap</span><a class="headerlink" href="#telapparser" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">fields</span><span class="o">=</span><span class="p">{</span> 
    <span class="s1">&#39;identifier&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/tel:fullText/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:title/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;alternative&#39;</span>
    <span class="s1">&#39;contributor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:contributor/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;subject&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:subject/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:description/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;typeOfResource&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/mods:typeOfResource/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:type/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;extent&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dcterms:extent/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;bibliographicCitation&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dcterms:bibliographicCitation/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:date/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:format/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dc:source/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/mods:location/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;isFormatOf&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/dcterms:isFormatOf/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;seeOnline&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/tel:seeOnline/text()&#39;</span><span class="p">),</span>
    <span class="s1">&#39;fullText&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;telap:record/tel:fullText/text()&#39;</span><span class="p">),},</span>    
<span class="n">namespaces</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;telap&#39;</span><span class="p">:</span><span class="s1">&#39;http://catalogue.bnf.fr/namespaces/TEL_ApplicationProfile&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dc&#39;</span> <span class="p">:</span> <span class="s1">&#39;http://purl.org/dc/elements/1.1/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mods&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.loc.gov/mods&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dcterms&#39;</span><span class="p">:</span> <span class="s1">&#39;http://purl.org/dc/terms/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tel&#39;</span><span class="p">:</span> <span class="s1">&#39;http://krait.kb.nl/coop/tel/handbook/telterms.html&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">didl</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fields&#39;</span><span class="p">:{</span>
        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;textList&#39;</span><span class="p">,</span> <span class="s1">&#39;didl:DIDL/didl:Item/didl:Descriptor/didl:Statement/oai_dc:dc/dc:source/text()&#39;</span><span class="p">)},</span>
    <span class="s1">&#39;namespaces&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;didl&#39;</span><span class="p">:</span><span class="s1">&#39;urn:mpeg:mpeg21:2002:02-DIDL-NS&#39;</span><span class="p">,</span>
        <span class="s1">&#39;dii&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;urn:mpeg:mpeg21:2002:01-DII-NS&#39;</span><span class="p">,</span>
        <span class="s1">&#39;oai_dc&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.openarchives.org/OAI/2.0/oai_dc/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;dc&#39;</span><span class="p">:</span><span class="s1">&#39;http://purl.org/dc/elements/1.1/&#39;</span><span class="p">},</span>
    <span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="s1">&#39;didl&#39;</span>
<span class="p">}</span>

<span class="n">gallica</span><span class="o">.</span><span class="n">getRecord</span><span class="p">(</span><span class="s1">&#39;bpt6k5499065k&#39;</span><span class="p">,</span><span class="n">metadata</span><span class="o">=</span><span class="n">didl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;source&#39;: [&quot;Bibliothèque nationale de France, département Philosophie, histoire, sciences de l&#39;homme, 4-LB57-4383&quot;]}
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="collecte-de-sets-present-dans-l-entrepot">
<span id="chunksize-research"></span><h3>Collecte de sets présent dans l’entrepôt<a class="headerlink" href="#collecte-de-sets-present-dans-l-entrepot" title="Permalink to this heading">#</a></h3>
<p>Le téléchargement d’un set, c’est-à-dire d’une collection disponible dans l’entrepôt, se fait de manière séquentielle. Lors d’une requête, les records nous sont envoyés par lots. La première requête nous retourne également un <code class="docutils literal notranslate"><span class="pre">resumptionToken</span></code> qui nous permet de lancer une deuxième requête à laquelle le <code class="docutils literal notranslate"><span class="pre">resumptionToken</span></code> sera attaché. Cela nous permet, requête par requête, <em>(page par page)</em> de collecter l’ensemble des records. Il nous indique également le nombre de records présents pour cette collection.</p>
<div class="literal-block-wrapper docutils container" id="tokenoai">
<div class="code-block-caption"><span class="caption-number">Listing 6 </span><span class="caption-text">Exemple de resumptionToken pour une collection (141542 records)</span><a class="headerlink" href="#tokenoai" title="Permalink to this code">#</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;resumptionToken</span><span class="w"> </span><span class="na">expirationDate=</span><span class="s">&quot;2023-06-05T11:07:26Z&quot;</span><span class="w"> </span><span class="na">completeListSize=</span><span class="s">&quot;141542&quot;</span><span class="w"> </span><span class="na">cursor=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>93!8!68469958!6018!100!141542!oai_dc<span class="nt">&lt;/resumptionToken&gt;</span>
</pre></div>
</div>
</div>
<p>Il est également important de noter que lors de l’appel de la fonction <code class="docutils literal notranslate"><span class="pre">pullSets()</span></code> il est possible de préciser la taille maximale d’un fichier<code class="docutils literal notranslate"><span class="pre">.json</span></code> lors de l’écriture des records. Par défaut, celui-ci est fixé à <code class="docutils literal notranslate"><span class="pre">20mb</span></code>, pour des grosses collections. Il est possible d’augmenter la taille maximum, mais il n’est généralement pas recommandé de descendre en dessous.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Par défaut, l&#39;ensemble des sets sont téléchargés dans un dossier`./data/json` qui comprendra l&#39;ensemble des sous-dossiers correspondant aux différents sets.</span>
<span class="sd">Il est possible de changer de chemin lors de l&#39;instanciation de la classe (si le dossier n&#39;existe pas, celui-ci sera créé automatiquement.)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">dir_</span> <span class="o">=</span> <span class="s1">&#39;./data/sets/&#39;</span>
<span class="n">gallica</span> <span class="o">=</span> <span class="n">OAINUM</span><span class="p">(</span><span class="s1">&#39;http://oai.bnf.fr/oai2//OAIHandler&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="n">dir_</span><span class="p">)</span>
<span class="c1">#sets_str = [&#39;gallica:corpus:BNUStr059&#39;, &#39;gallica:corpus:EnPCcorp18&#39;]</span>
<span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">setspec</span><span class="p">[</span><span class="mi">250</span><span class="p">],</span><span class="n">setspec</span><span class="p">[</span><span class="mi">290</span><span class="p">]]</span>
<span class="n">sets</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;gallica:corpus:BNUStr059&#39;, &#39;gallica:corpus:EnPCcorp15&#39;]
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gallica</span><span class="o">.</span><span class="n">pullSets</span><span class="p">(</span><span class="o">*</span><span class="n">sets</span><span class="p">,</span><span class="n">mb</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting records gallica:corpus:BNUStr059: 2639records [00:06, 380.20records/s]
Collecting records gallica:corpus:EnPCcorp15: 1580records [00:04, 334.93records/s]
</pre></div>
</div>
</div>
</details>
</div>
<p>Lors du téléchargement d’une collection un fichier <code class="docutils literal notranslate"><span class="pre">.log</span></code> est créé, celui-ci indique les records qui n’ont pas pu être récupérés, car supprimé de l’entrepôt. En effet, certains records sont supprimés avec leur métadonnée, même si leurs identifiants persistent.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pathfinder_log</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">directory</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span> 
                                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;*.log&#39;</span><span class="p">)]</span>
<span class="n">logs</span> <span class="o">=</span> <span class="n">pathfinder_log</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span>
<span class="k">if</span> <span class="n">logs</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>    
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2023-06-11 14:14:49] - INFO | ark:/12148/cb328036848/date est suprimmé du dépôt [&#39;gallica:corpus:BNUStr059&#39;, &#39;gallica:theme:0:00&#39;, &#39;gallica:typedoc:periodiques:titres&#39;]
</pre></div>
</div>
</div>
</details>
</div>
<a class="reference internal image-reference" href="../../_images/gallica-images-docnotfind.png"><img alt="document introuvable sur gallica" class="align-center" src="../../_images/gallica-images-docnotfind.png" style="width: 900px;" /></a>
</section>
<section id="collecte-des-images-a-travers-document-py">
<h3>Collecte des images à travers <code class="docutils literal notranslate"><span class="pre">document.py</span></code><a class="headerlink" href="#collecte-des-images-a-travers-document-py" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">document.py</span></code> est une classe qui permet de récupérer les métadonnées d’un document, et de télécharger les images associées sous les <em>form</em> IIIF.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">De par sa conception, asyncio n&#39;autorise pas l&#39;imbrication de sa boucle d&#39;événements. </span>
<span class="sd">Cela présente un problème pratique : dans un environnement où la boucle d&#39;événements est déjà en cours d&#39;exécution, </span>
<span class="sd">il est impossible d&#39;exécuter des tâches et d&#39;attendre le résultat. </span>
<span class="sd">Essayer de le faire donnera l&#39;erreur &quot;RuntimeError : Cette boucle d&#39;événements est déjà en cours d&#39;exécution&quot;.</span>
<span class="sd">Le problème apparaît dans divers environnements, tels que les serveurs Web, les applications graphiques et les blocs-notes Jupyter.</span>
<span class="sd">Ce module corrige asyncio pour permettre l&#39;utilisation imbriquée de asyncio.run et loop.run_until_complete</span>
<span class="sd">Note: seulement nécessaire à l&#39;intérieur d&#39;un jupyterbook</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">modules.record</span> <span class="kn">import</span> <span class="n">Document</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>  <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">skimage</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#La possibilité de récupérer les métadonnées sous le format &#39;oai_dc&#39; est avec le parseur par défaut</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s1">&#39;btv1b9077367m&#39;</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;title&#39;: [&#39;[Recueil. Les évènements du 06 février 1934] : [lot de photographies de presse] / [Agence Meurisse]&#39;],
 &#39;creator&#39;: [&#39;Agence de presse Meurisse. Agence photographique (commanditaire)&#39;],
 &#39;subject&#39;: [&#39;France -- 1934 (Manifestation du 6 février)&#39;],
 &#39;description&#39;: [&#39;Image de presse&#39;],
 &#39;publisher&#39;: [&#39;[Agence Meurisse] (Paris)&#39;],
 &#39;contributor&#39;: [],
 &#39;relation&#39;: [&#39;Notice du catalogue : http://catalogue.bnf.fr/ark:/12148/cb42479434g&#39;],
 &#39;coverage&#39;: [&#39;06 février 1934&#39;],
 &#39;identifier&#39;: [&#39;http://gallica.bnf.fr/ark:/12148/btv1b9077367m&#39;],
 &#39;rights&#39;: [&#39;domaine public&#39;],
 &#39;type&#39;: [&#39;image fixe&#39;, &#39;photographie&#39;],
 &#39;language&#39;: [&#39;fre&#39;],
 &#39;date&#39;: [&#39;1934&#39;],
 &#39;format&#39;: [&#39;27 photogr. nég. sur verre : n. et b.&#39;,
  &#39;image/jpeg&#39;,
  &#39;Nombre total de vues :  27&#39;],
 &#39;source&#39;: [&#39;Bibliothèque nationale de France, département Estampes et photographie, EI-13&#39;]}
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#La possibilité également de récupérer toutes les images correspondant à ce document</span>
<span class="n">doc</span><span class="o">.</span><span class="n">images</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f1/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f2/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f3/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f4/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f5/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f6/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f7/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f8/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f9/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f10/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f11/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f12/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f13/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f14/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f15/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f16/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f17/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f18/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f19/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f20/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f21/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f22/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f23/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f24/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f25/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f26/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/btv1b9077367m/f27/full/full/0/native.jpg&#39;]
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">22</span><span class="p">])</span>
<span class="n">img_rgb</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">gray2rgb</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_rgb</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f9e4fd08eaaabcd86ab714a629c61643cd889655765c1566f56eb1839eaee5f7.png" src="../../_images/f9e4fd08eaaabcd86ab714a629c61643cd889655765c1566f56eb1839eaee5f7.png" />
</div>
</div>
<p>Il est possible de télécharger les images correspondant au document de façon asynchrone. Des limitations surviennent pendant l’utilisation de l’API <a class="reference external" href="https://iiif.io/">IIIF</a> de la BnF <em>(hors serveur interne à la BnF)</em>. Un algorithme de <a class="reference external" href="https://fr.wikipedia.org/wiki/Seau_perc%C3%A9">seau percé</a> est mis en place afin d’éviter les erreurs dues aux limitations mises en place par l’API.
Le seau percé est utilisé pour mettre en œuvre la régulation du trafic et la mise en forme du trafic dans les réseaux de données Ethernet et cellulaires. Il peut également être utilisé pour contrôler les connexions Internet à bande passante mesurée afin d’empêcher les utilisateurs de dépasser la bande passante allouée pendant une période spécifiée, évitant ainsi des frais supplémentairesou limitations mises en place par l’API</p>
<div class="mermaid">
            stateDiagram-v2
direction TB
state client_timeout{
[*] --&gt; manifest.json
manifest.json  --&gt; get_img_timeout : len(img)

	concurrents_img--&gt;seconds_img :window
	seconds_img--&gt;concurrents_img :allows

	concurrents_img--&gt; get_img_timeout : authorize
	
	f(n)/(ark)/(region)/(size)/(rotation)/(quality)/.()extension --&gt; img :chunksize
	
	state get_img_timeout {
	[*] --&gt;f(n)/(ark)/(region)/(size)/(rotation)/(quality)/.()extension
	f(n)/(ark)/(region)/(size)/(rotation)/(quality)/.()extension
	}
}
        </div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">&#39;client_timeout&#39;: fixe le délais d&#39;expiration de la session</span>
<span class="sd">&#39;get_manifest_timeout&#39;: fixe le délais d&#39;expiration de la requête qui récupère le fichier .json contenant les infos sur le nombre</span>
<span class="sd">d&#39;images et leurs url</span>
<span class="sd">&#39;get_img_timeout&#39;: fixe le délais d&#39;expiration de la requête qui récupère l&#39;image</span>
<span class="sd">&#39;chunksize&#39;: la taille en octet de chunk lors du téléchargement de l&#39;image</span>

<span class="sd">Note:(Par défaut l&#39;ensemble des timeout sont fixés sur la valeur de la session,</span>
<span class="sd">get_img_timeout override client_timeout si la valeur change)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">doc</span><span class="o">.</span><span class="n">leaky_bucket</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;concurrents_img&#39;: 50,
 &#39;seconds_img&#39;: 60,
 &#39;client_timeout&#39;: 60,
 &#39;get_img_timeout&#39;: 60,
 &#39;get_manifest_timeout&#39;: 60,
 &#39;chunksize&#39;: 1024}
</pre></div>
</div>
</div>
</div>
<div class="dropdown admonition attention">
<p class="admonition-title">Attention</p>
<p>Ces paramètres n’engendrent pas d’erreur due aux limitations de l’API. Il est possible de réécrire ce dictionnaire une fois la classe instanciée, mais il est déconseillé de le faire si le code n’est pas lancé sur le serveur interne de la BnF</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span><span class="o">.</span><span class="n">params_dft</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;name&#39;: &#39;202306111415&#39;,
 &#39;image&#39;: False,
 &#39;region&#39;: &#39;full&#39;,
 &#39;size&#39;: &#39;full&#39;,
 &#39;rotation&#39;: &#39;0&#39;,
 &#39;quality&#39;: &#39;native&#39;,
 &#39;extension&#39;: &#39;jpg&#39;}
</pre></div>
</div>
</div>
</div>
<p id="docparams-dft">Chaque image est téléchargée selon les paramètres par défaut de la classe disponible dans <code class="docutils literal notranslate"><span class="pre">.params_dft</span></code>. Il est possible de réécrire ces paramètres selon les standards mis en place à travers le protocole <a class="reference external" href="https://en.wikipedia.org/wiki/International_Image_Interoperability_Framework">IIIF</a>. La document de l’API est disponible <a class="reference external" href="https://iiif.io/api/image/3.0/">ici</a> elle fournit l’ensemble des <em>form</em> disponible et associées à chaque clée du dictionnaire <code class="docutils literal notranslate"><span class="pre">.params_dft</span></code>.<br />
L’utilisateur peut également passer une liste d’images à télécharger à travers la cléf <code class="docutils literal notranslate"><span class="pre">.params_df['image']</span></code>. Si une liste est présente l’ensemble des autres paramètres s’appliqueront aux images à moins de passer également une autre liste de même taille (où les indices des éléments deviendrons les paramètres à associer)
Une fois l’image téléchargée, le nom de l’image contiendra l’ark et l’ensemble des paramètres associés à celle-ci par exemple:<code class="docutils literal notranslate"><span class="pre">bpt6k62463369-f1-full-pct#30-0-native-lerire_journalhumoristique.jpg</span></code>.</p>
<p>La clé<code class="docutils literal notranslate"><span class="pre">.params_dft['name']</span></code> indique la possibilité d’ajouter un attribut dans le nom du fichier afin de créer une classe d’images <em>(par défaut, il correspond à la date de téléchargement)</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Si liste il y a, elles doivent être de même tailles</span>
<span class="n">params_x</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;first_img&#39;</span><span class="p">,</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;dft&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;last_img&#39;</span><span class="p">]</span> <span class="p">,</span>
    <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span><span class="s1">&#39;f5&#39;</span><span class="p">,</span><span class="s1">&#39;f6&#39;</span><span class="p">,</span><span class="s1">&#39;f16&#39;</span><span class="p">],</span>
    <span class="s1">&#39;size&#39;</span> <span class="p">:[</span><span class="s1">&#39;full&#39;</span><span class="p">,</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;pct:20&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;full&#39;</span><span class="p">],</span>
    <span class="s1">&#39;quality&#39;</span><span class="p">:[</span><span class="s1">&#39;native&#39;</span><span class="p">,</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;gray&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;native&#39;</span><span class="p">],</span>
<span class="p">}</span>
<span class="c1">#Récupérer l&#39;ensemble des images mais sous deux formats différent avec une taille de 50%</span>
<span class="n">params_y</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;extension&#39;</span><span class="p">:[</span><span class="s1">&#39;jpg&#39;</span><span class="p">,</span><span class="s1">&#39;png&#39;</span><span class="p">],</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;pct:50&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Le dossier de téléchargement par défaut est &#39;./data/images&#39;, un nouveau dossier est créé si le dossier présent dans l&#39;argument n&#39;existe pas.</span>
<span class="sd">Lors du téléchargement d&#39;image(s) un fichier &#39;.log&#39; est créé qui recense les erreurs.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">doc</span><span class="o">.</span><span class="n">fetch_image</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./data/img/same_lenght&#39;</span><span class="p">,</span><span class="n">params_img</span><span class="o">=</span><span class="n">params_x</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">fetch_image</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./data/img/jpg_png_50percent&#39;</span><span class="p">,</span><span class="n">params_img</span><span class="o">=</span><span class="n">params_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ici un exemple de dictionnaire avec des tailles de liste différente cela déclencheras une erreur</span>
<span class="n">params_error</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;first_img&#39;</span><span class="p">,</span><span class="s1">&#39;last_img&#39;</span><span class="p">]</span> <span class="p">,</span>
    <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span><span class="s1">&#39;f5&#39;</span><span class="p">,</span><span class="s1">&#39;f6&#39;</span><span class="p">,</span><span class="s1">&#39;f16&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">doc</span><span class="o">.</span><span class="n">fetch_image</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./data/img/from_error&#39;</span><span class="p">,</span><span class="n">params_img</span><span class="o">=</span><span class="n">params_error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">--------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                   </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#Ici un exemple de dictionnaire avec des tailles de liste différente cela déclencheras une erreur</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">params_error</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;first_img&#39;</span><span class="p">,</span><span class="s1">&#39;last_img&#39;</span><span class="p">]</span> <span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span><span class="s1">&#39;f5&#39;</span><span class="p">,</span><span class="s1">&#39;f6&#39;</span><span class="p">,</span><span class="s1">&#39;f16&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">}</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">doc</span><span class="o">.</span><span class="n">fetch_image</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./data/img/from_error&#39;</span><span class="p">,</span><span class="n">params_img</span><span class="o">=</span><span class="n">params_error</span><span class="p">)</span>

<span class="nn">File ~\Documents\GALLICA\gallica\book\notebooks\modules\tools.py:103,</span> in <span class="ni">set_event_loop_policy.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span>     <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop_policy</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">WindowsSelectorEventLoopPolicy</span><span class="p">())</span>
<span class="ne">--&gt; </span><span class="mi">103</span>     <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<span class="nn">File ~\miniconda3\lib\site-packages\nest_asyncio.py:35,</span> in <span class="ni">_patch_asyncio.&lt;locals&gt;.run</span><span class="nt">(main, debug)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">35</span>     <span class="k">return</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>

<span class="nn">File ~\miniconda3\lib\site-packages\nest_asyncio.py:90,</span> in <span class="ni">_patch_loop.&lt;locals&gt;.run_until_complete</span><span class="nt">(self, future)</span>
<span class="g g-Whitespace">     </span><span class="mi">87</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
<span class="g g-Whitespace">     </span><span class="mi">88</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>         <span class="s1">&#39;Event loop stopped before Future completed.&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">90</span> <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="nn">File ~\miniconda3\lib\asyncio\futures.py:201,</span> in <span class="ni">Future.result</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span> <span class="bp">self</span><span class="o">.</span><span class="n">__log_traceback</span> <span class="o">=</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">200</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">201</span>     <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result</span>

<span class="nn">File ~\miniconda3\lib\asyncio\tasks.py:256,</span> in <span class="ni">Task.__step</span><span class="nt">(***failed resolving arguments***)</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>     <span class="k">if</span> <span class="n">exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span>         <span class="c1"># We use the `send` method directly, because coroutines</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span>         <span class="c1"># don&#39;t have `__iter__` and `__next__` methods.</span>
<span class="ne">--&gt; </span><span class="mi">256</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">coro</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">257</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">coro</span><span class="o">.</span><span class="n">throw</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

<span class="nn">File ~\Documents\GALLICA\gallica\book\notebooks\modules\record.py:104,</span> in <span class="ni">Document.fetch_image</span><span class="nt">(self, directory, params_img)</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> 	<span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setparams</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_dft</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">104</span> 	<span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setparams</span><span class="p">(</span><span class="n">params_img</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">106</span> <span class="n">fill</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span> <span class="n">switch</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">x</span>

<span class="nn">File ~\Documents\GALLICA\gallica\book\notebooks\modules\record.py:78,</span> in <span class="ni">Document.setparams</span><span class="nt">(self, params)</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> 			<span class="k">return</span> <span class="n">document</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">78</span> 	<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lenght is not the same between list </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">check_length</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="ne">ValueError</span>: Lenght is not the same between list [2, 5]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="fouille-de-donnee-research-multiprocessing-py">
<h2>Fouille de donnée <code class="docutils literal notranslate"><span class="pre">research_multiprocessing.py</span></code><a class="headerlink" href="#fouille-de-donnee-research-multiprocessing-py" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">De par sa conception, asyncio n&#39;autorise pas l&#39;imbrication de sa boucle d&#39;événements. </span>
<span class="sd">Cela présente un problème pratique : dans un environnement où la boucle d&#39;événements est déjà en cours d&#39;exécution, </span>
<span class="sd">il est impossible d&#39;exécuter des tâches et d&#39;attendre le résultat. </span>
<span class="sd">Essayer de le faire donnera l&#39;erreur &quot;RuntimeError : Cette boucle d&#39;événements est déjà en cours d&#39;exécution&quot;.</span>
<span class="sd">Le problème apparaît dans divers environnements, tels que les serveurs Web, les applications graphiques et les blocs-notes Jupyter.</span>
<span class="sd">Ce module corrige asyncio pour permettre l&#39;utilisation imbriquée de asyncio.run et loop.run_until_complete</span>
<span class="sd">Note: seulement nécessaire à l&#39;intérieur d&#39;un jupyterbook</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">modules.research_multiprocessing</span> <span class="kn">import</span> <span class="n">mapping2csv</span>
<span class="kn">from</span> <span class="nn">modules.iiif_from_csv</span> <span class="kn">import</span> <span class="n">collecting_images</span><span class="p">,</span> <span class="n">default_img</span><span class="p">,</span> <span class="n">leaky_bucket_layer</span>
<span class="kn">from</span> <span class="nn">modules.record</span> <span class="kn">import</span> <span class="n">Document</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>  <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">fnmatch</span> <span class="kn">import</span> <span class="n">fnmatch</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">skimage</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pour des raisons pratiques un ensemble de collection est disponible au téléchargement via ce lien <a class="reference external" href="https://drive.google.com/drive/folders/1PIurNg4_3YLPwNNN378EEyWRASdg324n?usp=drive_link">Google Drive</a>. Il contient un ensemble de fichiers <code class="docutils literal notranslate"><span class="pre">.json</span></code> appartenant à différentes collections <em>(set)</em></p>
</div>
<p>Le module <code class="docutils literal notranslate"><span class="pre">research_multiprocessing()</span></code> permet la fouille en parallèle de plusieurs fichiers .json récupérer via <code class="docutils literal notranslate"><span class="pre">oai.py</span></code> par la recherche de chaînes de caractères à l’intérieur des métadonnées. Pour ce faire il suffit de créer un dictionnaire dont la cle indique le <code class="docutils literal notranslate"><span class="pre">group</span></code> associé aux <code class="docutils literal notranslate"><span class="pre">match</span></code> c’est à dire aux chaînes de caractères (sous forme de <a class="reference external" href="https://docs.python.org/fr/3/howto/regex.html">regex</a>). Cela nous permet de créer des listes d’autoritée pour un ensemble d’expressions. Si une expression est trouvée, le module retourne <code class="docutils literal notranslate"><span class="pre">(ark,group,match,from)</span></code> le <code class="docutils literal notranslate"><span class="pre">from</span></code> indique la localisation du match (une des <code class="docutils literal notranslate"><span class="pre">.keys()</span></code> renvoyée par le <em>parser</em>)</p>
<p>Lors du lancement de <code class="docutils literal notranslate"><span class="pre">mapping2csv()</span></code> le module liste l’ensemble des fichiers <code class="docutils literal notranslate"><span class="pre">.json</span></code> présent dans le dossier. L’argument <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> indique le nombre de partitions que l’on veut distribuer (une partition par <em>process</em>). Le nombre de <em>process</em> dépend du nombre de <em>cores</em> présents sur la machine.<br />
La création d’un process exige un certain temps, il est donc essentiel d’avoir des fichiers <code class="docutils literal notranslate"><span class="pre">.json</span></code>
<a class="reference internal" href="#chunksize-research"><span class="std std-ref">ni trop gros, ni trop petit</span></a> en terme de taille. Mais également un <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> qui prend en considération le nombre de <em>cores</em>.</p>
<div class="dropdown admonition warning">
<p class="admonition-title">Warning</p>
<p>Avant la création de chaque partition <em>(dont les tailles dépend de chunksize et du nombre total de fichiers)</em>. Les fichiers sont mélangés, cela permet de rééquilibrer la distribution des fichiers par <em>process</em>, car certains fichiers peuvent contenir plus de records <em>(même si une taille maximum par fichier est de 20mb, un fichier peu très bien faire une taille de 3mb)</em><br />
Il faut également se limiter à un dictionnaire résonnable ainsi qu’être prudent lors de la recherche d’expressions, par exemple rechercher le mot “il” ou “elle” peut générer un fichier CSV avec une taille de plusieurs giga octets.</p>
</div>
<div class="mermaid">
            stateDiagram-v2
direction LR
[*] --&gt; *json
*json--&gt; *json:shuffle
	*json--&gt;process(1)
	*json--&gt;process(2)
	*json--&gt;process(4)
	*json--&gt;process(3)
	
	state ProcessPoolExecutor() {
	process(1)
	process(2)
	process(3)
	process(4)
	}
	
	process(1)--&gt;.csv[process.1.1]
	process(1)--&gt;.csv[process.1.2]
	process(2)--&gt;.csv[process.2.1]
	process(2)--&gt;.csv[process.2.2]
	process(3)--&gt;.csv[process.3.1]
	process(4)--&gt;.csv[process.4.1]
	
	state temp{
	.csv[process.1.1]
	.csv[process.1.2]
	.csv[process.2.1]
	.csv[process.2.2]
	.csv[process.3.1]
	.csv[process.4.1]
	}
	.csv[process.1.1]--&gt;.csv
	.csv[process.1.2]--&gt;.csv
	.csv[process.2.1]--&gt;.csv
	.csv[process.2.2]--&gt;.csv
	.csv[process.3.1]--&gt;.csv
	.csv[process.4.1]--&gt;.csv
	
		
	note right of *json
            chunksize=4
            len(*json)//4
        end note 
        </div><div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Localisaton du fichier Google Drive (sur votre machine)</span>
<span class="n">directory_of_records</span> <span class="o">=</span> <span class="s1">&#39;./data/json/&#39;</span>
<span class="n">chunksize</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">n_json</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">directory</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> 
                                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;*.json&#39;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Le dossier comprend </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n_json</span><span class="p">(</span><span class="n">directory_of_records</span><span class="p">))</span><span class="si">}</span><span class="s1"> fichiers .json, pour chunksize=20, chaque process traiteras ~</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n_json</span><span class="p">(</span><span class="n">directory_of_records</span><span class="p">))</span><span class="o">//</span><span class="n">chunksize</span><span class="si">}</span><span class="s1"> fichiers&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Le dossier comprend 453 fichiers .json, pour chunksize=20, chaque process traiteras ~22 fichiers
</pre></div>
</div>
</div>
</details>
</div>
<div class="dropdown admonition note">
<p class="admonition-title">Note</p>
<p>La compilation des expressions régulière se fait en <code class="docutils literal notranslate"><span class="pre">re.IGNORECASE</span></code>, c’est à dire qu’elles ne sont pas sensibles aux majuscules et minuscules</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Nous créons un dictionnaire avec quatre clées &#39;artiste&#39;, &#39;estampe&#39;, &#39;date&#39;, &#39;techniques&#39; (group):</span>
<span class="sd">artiste: recherche l&#39;expression &#39;Gustave Doré&#39;</span>
<span class="sd">estampe: une liste d&#39;autorité pour le mot estampe </span>
<span class="sd">date: recherche des dates correspondant aux 20/19/18ème siècles</span>
<span class="sd">techniques: recherche un ensemble d&#39;expressions correspondant aux techniques artistiques</span>

<span class="sd">Note: la double barre oblique est obligatoire pour signaler qu&#39;il s&#39;agit bien d&#39;un caractère spécial</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">regex</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;artiste&quot;</span><span class="p">:[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bGustave Doré</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">],</span>
    <span class="s2">&quot;estampe&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bestampe</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">best</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">b&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b19\d</span><span class="si">{2}</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b18\d</span><span class="si">{2}</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b17\d</span><span class="si">{2}</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">],</span> 
    <span class="s2">&quot;techniques&quot;</span><span class="p">:[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bmine de plomb</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bfiligrane</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bdétrempe</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bsanguine</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bcraie</span><span class="se">\b</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">btempera</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bcrayon</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bplume</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bpointe de métal</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bfusain</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">brehauts</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bgraphite</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bmétallogallique</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bfeutre</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bstylo</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bcarbone</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bpierre noire</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bpastel</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bgouache</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bmine</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bgouache</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bhuile</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bpinceau</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bpeinture</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">baquarelle</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">baquarelle</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bencre</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bencre</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bencre de chine</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">blavis</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bcrachis</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bbistre</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">La barre de progression risque de mettre un certain temps avant de démarrer (le temps de création des process et des premiers résultats)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">mapping2csv</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory_of_records</span><span class="p">,</span><span class="n">chunksize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">authority</span><span class="o">=</span><span class="n">regex</span><span class="p">,</span><span class="n">write_at</span><span class="o">=</span><span class="s1">&#39;./data/csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|████████████████████████| 23/23 [01:56&lt;00:00,  5.07s/it]
Reading files: 100%|████| 46/46 [00:22&lt;00:00,  2.05CSVTEMP/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8,000,604 rows for 237.12mb for the CSV
7,506,857 records read for a mean of 326,385.09 by process for 16 process by default
0 file(s) error(s) during the process
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Importation du CSV  to low_memory=False, attention ici les &#39;ark&#39; ne sont pas unique,</span>
<span class="sd">car un &#39;ark&#39; peut appartenir à plusieurs &#39;group&#39; d&#39;expressions</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="c1"># &#39;read_csv&#39; pointe vers le l&#39;endroit où le fichier à était téléchager sur votre machine</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/csv/CSV_14-17-39-06-11-2023.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>group</th>
      <th>match</th>
      <th>from</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bpt6k34067388</td>
      <td>date</td>
      <td>1942</td>
      <td>date</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bpt6k3386531n</td>
      <td>date</td>
      <td>1932</td>
      <td>date</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bpt6k33694004</td>
      <td>date</td>
      <td>1941</td>
      <td>date</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bpt6k34003277</td>
      <td>date</td>
      <td>1953</td>
      <td>date</td>
    </tr>
    <tr>
      <th>4</th>
      <td>bpt6k3360507k</td>
      <td>date</td>
      <td>1959</td>
      <td>date</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8000599</th>
      <td>btv1b53094289g</td>
      <td>date</td>
      <td>1945;1861;1914;1926</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>8000600</th>
      <td>btv1b53094289g</td>
      <td>date</td>
      <td>1922</td>
      <td>coverage</td>
    </tr>
    <tr>
      <th>8000601</th>
      <td>btv1b53094289g</td>
      <td>date</td>
      <td>1922</td>
      <td>date</td>
    </tr>
    <tr>
      <th>8000602</th>
      <td>btv1b53097632t</td>
      <td>date</td>
      <td>1860</td>
      <td>identifier</td>
    </tr>
    <tr>
      <th>8000603</th>
      <td>btv1b53097632t</td>
      <td>date</td>
      <td>1910</td>
      <td>date</td>
    </tr>
  </tbody>
</table>
<p>8000604 rows × 4 columns</p>
</div></div></div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">1. Créer une copie du DataFrame en filtrant le group &#39;artiste&#39;</span>
<span class="sd">2. Supprime la colonne &#39;group&#39;</span>
<span class="sd">3. Renomme la colonne &#39;from&#39; --&gt; &#39;artist_from&#39; / &#39;match&#39; --&gt; &#39;artist&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">df_artist</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;artiste&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_artist</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_artist</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s1">&#39;artist_from&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_artist</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;match&#39;</span><span class="p">:</span> <span class="s1">&#39;artist&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_artist</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>artist</th>
      <th>artist_from</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19911</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
    <tr>
      <th>102461</th>
      <td>btv1b102183889</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
    <tr>
      <th>102965</th>
      <td>btv1b10217613z</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
    <tr>
      <th>535809</th>
      <td>btv1b531008568</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
    <tr>
      <th>535982</th>
      <td>btv1b531008746</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7515877</th>
      <td>btv1b103210850</td>
      <td>Gustave Doré</td>
      <td>relation</td>
    </tr>
    <tr>
      <th>7515883</th>
      <td>btv1b103210833</td>
      <td>Gustave Doré</td>
      <td>relation</td>
    </tr>
    <tr>
      <th>7515889</th>
      <td>btv1b10321030p</td>
      <td>Gustave Doré</td>
      <td>relation</td>
    </tr>
    <tr>
      <th>7515895</th>
      <td>btv1b10321052d</td>
      <td>Gustave Doré</td>
      <td>relation</td>
    </tr>
    <tr>
      <th>7573431</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
  </tbody>
</table>
<p>4958 rows × 3 columns</p>
</div></div></div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">1. Créer une copie du DataFrame et filtre le group &#39;date&#39;</span>
<span class="sd">2. Supprime la colonne &#39;group&#39;</span>
<span class="sd">3. Renomme la colonne &#39;from&#39; --&gt; &#39;date_from&#39; / &#39;match&#39; --&gt; &#39;date&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">df_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_date</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_date</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s1">&#39;date_from&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_date</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;match&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_date</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>date</th>
      <th>date_from</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bpt6k34067388</td>
      <td>1942</td>
      <td>date</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bpt6k3386531n</td>
      <td>1932</td>
      <td>date</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bpt6k33694004</td>
      <td>1941</td>
      <td>date</td>
    </tr>
    <tr>
      <th>3</th>
      <td>bpt6k34003277</td>
      <td>1953</td>
      <td>date</td>
    </tr>
    <tr>
      <th>4</th>
      <td>bpt6k3360507k</td>
      <td>1959</td>
      <td>date</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8000599</th>
      <td>btv1b53094289g</td>
      <td>1945;1861;1914;1926</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>8000600</th>
      <td>btv1b53094289g</td>
      <td>1922</td>
      <td>coverage</td>
    </tr>
    <tr>
      <th>8000601</th>
      <td>btv1b53094289g</td>
      <td>1922</td>
      <td>date</td>
    </tr>
    <tr>
      <th>8000602</th>
      <td>btv1b53097632t</td>
      <td>1860</td>
      <td>identifier</td>
    </tr>
    <tr>
      <th>8000603</th>
      <td>btv1b53097632t</td>
      <td>1910</td>
      <td>date</td>
    </tr>
  </tbody>
</table>
<p>7716474 rows × 3 columns</p>
</div></div></div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Créer une jointure (comme en SQL) sur la colonne &#39;ark&#39;</span>
<span class="sd">Normalise la colonne &#39;date&#39; car plusieurs date peuvent être présentes (;) et le séparateur de champs</span>
<span class="sd">Le résulat est un DataFrame avec toutes les dates trouvées en lien avec l&#39;artiste &#39;Gustave Doré&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">df_jointure</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_artist</span><span class="p">,</span> <span class="n">df_date</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ark&#39;</span><span class="p">)</span>
<span class="n">df_jointure</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_jointure</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">df_n</span> <span class="o">=</span> <span class="n">df_jointure</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df_n</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_n</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
<span class="n">df_n</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>artist</th>
      <th>artist_from</th>
      <th>date</th>
      <th>date_from</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1832-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>0</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1883-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>0</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1820-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>0</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1910-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>1</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1869-01-01</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14574</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1832-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>14574</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1883-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>14575</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1872-01-01</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>14575</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1811-01-01</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>14576</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1868-01-01</td>
      <td>date</td>
    </tr>
  </tbody>
</table>
<p>31521 rows × 5 columns</p>
</div></div></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Histogramme des dates où Gustave Doré est présent sur Gallica </span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_n</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Période associée à l&#39;expression {Gustave Doré} présent dans Gallica Images &quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Période&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a4eb6ededc8bfac742fe75a8bb21ef177472bf29c9b7f7f799e10719ab2fe42b.png" src="../../_images/a4eb6ededc8bfac742fe75a8bb21ef177472bf29c9b7f7f799e10719ab2fe42b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Quand on analyse le graphique on remarque que les deux années qui reviennent le plus souvent sont l&#39;année</span>
<span class="sd">de naissance et l&#39;année de mort de Gustave Doré (1832-1883). Ce qui semble logique puisque l&#39;expression</span>
<span class="sd">&#39;Gustave Doré&#39; doit être le plus souvent associée celle-ci.</span>
<span class="sd">Nous allons donc sélectionner les 5 premières date les plus fréquente pour la suite du filtrage</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">df_n</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1832-01-01    4974
1883-01-01    4939
1855-01-01    2319
1860-01-01    1640
1873-01-01    1339
Name: date, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Filtre la DataFrame en gardant uniquement les 5 premières dates plus fréquente</span>
<span class="n">df_filtering_date</span> <span class="o">=</span> <span class="n">df_n</span><span class="p">[</span><span class="n">df_n</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_n</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())]</span>
<span class="n">df_filtering_date</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>artist</th>
      <th>artist_from</th>
      <th>date</th>
      <th>date_from</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1832-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>0</th>
      <td>btv1b105397373</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1883-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>4</th>
      <td>btv1b10217613z</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1832-01-01</td>
      <td>title</td>
    </tr>
    <tr>
      <th>4</th>
      <td>btv1b10217613z</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1883-01-01</td>
      <td>title</td>
    </tr>
    <tr>
      <th>6</th>
      <td>btv1b531008568</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1883-01-01</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>14571</th>
      <td>btv1b10321052d</td>
      <td>Gustave Doré</td>
      <td>relation</td>
      <td>1883-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>14572</th>
      <td>btv1b10321052d</td>
      <td>Gustave Doré</td>
      <td>relation</td>
      <td>1855-01-01</td>
      <td>relation</td>
    </tr>
    <tr>
      <th>14573</th>
      <td>btv1b10321052d</td>
      <td>Gustave Doré</td>
      <td>relation</td>
      <td>1855-01-01</td>
      <td>date</td>
    </tr>
    <tr>
      <th>14574</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1832-01-01</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>14574</th>
      <td>btv1b9003663t</td>
      <td>Gustave Doré</td>
      <td>title</td>
      <td>1883-01-01</td>
      <td>creator</td>
    </tr>
  </tbody>
</table>
<p>15211 rows × 5 columns</p>
</div></div></div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Récupère le DataFrame original et filtre avec les ark qui correspond à la date la plus fréquente</span>
<span class="sd">df_filtering_date_max[&#39;ark&#39;].tolist() transforme la colonne &#39;ark&#39; en list()</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">df_filtering</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ark&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_filtering_date</span><span class="p">[</span><span class="s1">&#39;ark&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())]</span>
<span class="n">df_filtering</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>group</th>
      <th>match</th>
      <th>from</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19911</th>
      <td>btv1b105397373</td>
      <td>artiste</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
    <tr>
      <th>19912</th>
      <td>btv1b105397373</td>
      <td>techniques</td>
      <td>Peinture</td>
      <td>title</td>
    </tr>
    <tr>
      <th>19913</th>
      <td>btv1b105397373</td>
      <td>date</td>
      <td>1832;1883;1820;1910</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>19914</th>
      <td>btv1b105397373</td>
      <td>date</td>
      <td>1869;1800</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>19915</th>
      <td>btv1b105397373</td>
      <td>techniques</td>
      <td>Peinture</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7573431</th>
      <td>btv1b9003663t</td>
      <td>artiste</td>
      <td>Gustave Doré</td>
      <td>title</td>
    </tr>
    <tr>
      <th>7573432</th>
      <td>btv1b9003663t</td>
      <td>date</td>
      <td>1832;1883</td>
      <td>creator</td>
    </tr>
    <tr>
      <th>7573433</th>
      <td>btv1b9003663t</td>
      <td>date</td>
      <td>1872;1811</td>
      <td>subject</td>
    </tr>
    <tr>
      <th>7573434</th>
      <td>btv1b9003663t</td>
      <td>estampe</td>
      <td>estampe</td>
      <td>type</td>
    </tr>
    <tr>
      <th>7573435</th>
      <td>btv1b9003663t</td>
      <td>date</td>
      <td>1868</td>
      <td>date</td>
    </tr>
  </tbody>
</table>
<p>25899 rows × 4 columns</p>
</div></div></div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Combine toutes les méthodes vues précédemment,</span>
<span class="sd">afin de récupérer un DataFrame qui recense les techniques les plus fréquentes en lien avec les estampes</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1">#Filtre les estampes</span>
<span class="n">df_est</span> <span class="o">=</span> <span class="n">df_filtering</span><span class="p">[</span><span class="n">df_filtering</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;estampe&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_est</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="s1">&#39;match&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_est</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s1">&#39;estampe_from&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_est</span>

<span class="c1">#Filtre les techniques</span>
<span class="n">df_tech</span> <span class="o">=</span> <span class="n">df_filtering</span><span class="p">[</span><span class="n">df_filtering</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;techniques&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_tech</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;group&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_tech</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s1">&#39;techniques_from&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_tech</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;match&#39;</span><span class="p">:</span> <span class="s1">&#39;techniques&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_tech</span>

<span class="c1">#Jointure entre les tables sur la clée &#39;ark&#39;</span>
<span class="n">df_jointure2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tech</span><span class="p">,</span> <span class="n">df_est</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ark&#39;</span><span class="p">)</span>
<span class="n">df_jointure2</span><span class="p">[</span><span class="s1">&#39;techniques&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_jointure2</span><span class="p">[</span><span class="s1">&#39;techniques&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">df_jointure2</span> <span class="o">=</span> <span class="n">df_jointure2</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;techniques&#39;</span><span class="p">)</span>
<span class="n">df_jointure2</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_jointure2</span><span class="p">[</span><span class="s1">&#39;techniques&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="n">df_jointure2</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>plume    82
mine      8
huile     2
encre     2
Name: techniques, dtype: int64
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>techniques</th>
      <th>techniques_from</th>
      <th>estampe_from</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>btv1b103200361</td>
      <td>mine</td>
      <td>title</td>
      <td>title</td>
    </tr>
    <tr>
      <th>1</th>
      <td>btv1b103200361</td>
      <td>mine</td>
      <td>title</td>
      <td>type</td>
    </tr>
    <tr>
      <th>2</th>
      <td>btv1b103197173</td>
      <td>plume</td>
      <td>format</td>
      <td>title</td>
    </tr>
    <tr>
      <th>3</th>
      <td>btv1b103197173</td>
      <td>plume</td>
      <td>format</td>
      <td>type</td>
    </tr>
    <tr>
      <th>4</th>
      <td>btv1b10319720c</td>
      <td>plume</td>
      <td>format</td>
      <td>title</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>89</th>
      <td>btv1b10319743j</td>
      <td>plume</td>
      <td>format</td>
      <td>type</td>
    </tr>
    <tr>
      <th>90</th>
      <td>btv1b10319748s</td>
      <td>plume</td>
      <td>format</td>
      <td>title</td>
    </tr>
    <tr>
      <th>91</th>
      <td>btv1b10319748s</td>
      <td>plume</td>
      <td>format</td>
      <td>type</td>
    </tr>
    <tr>
      <th>92</th>
      <td>btv1b103205809</td>
      <td>plume</td>
      <td>format</td>
      <td>title</td>
    </tr>
    <tr>
      <th>93</th>
      <td>btv1b103205809</td>
      <td>plume</td>
      <td>format</td>
      <td>type</td>
    </tr>
  </tbody>
</table>
<p>94 rows × 4 columns</p>
</div></div></div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">1.Filtre le DataFrame selon la localisation</span>
<span class="sd">  1.1 L&#39;estampe doit être présent dans le champs &#39;type&#39; et &#39;format&#39;</span>
<span class="sd">  1.2 Les techniques doivent être présente dans le champ &#39;format&#39;</span>
<span class="sd">2.Créer une liste de techniques uniques (en fonction du filtrage précédent)</span>
<span class="sd">3.Parcours cette liste pour créer un dictionnaire qui rassemble les &#39;ark&#39; sous les techniques qui sont uniques</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">technique_ark</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">filtering_1</span> <span class="o">=</span> <span class="n">df_jointure2</span><span class="p">[(</span><span class="n">df_jointure2</span><span class="p">[</span><span class="s1">&#39;estampe_from&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_jointure2</span><span class="p">[</span><span class="s1">&#39;estampe_from&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;format&#39;</span><span class="p">)]</span>
<span class="n">filtering_2</span> <span class="o">=</span> <span class="n">filtering_1</span><span class="p">[</span><span class="n">filtering_1</span><span class="p">[</span><span class="s1">&#39;techniques_from&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;format&#39;</span><span class="p">]</span>
<span class="n">unique_techniques</span> <span class="o">=</span> <span class="n">filtering_2</span><span class="p">[</span><span class="s1">&#39;techniques&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="k">for</span> <span class="n">technique</span> <span class="ow">in</span> <span class="n">unique_techniques</span><span class="p">:</span>
    <span class="c1"># Filtrage des ARK pour la technique donnée</span>
    <span class="n">arks</span> <span class="o">=</span> <span class="n">filtering_2</span><span class="p">[</span><span class="n">filtering_2</span><span class="p">[</span><span class="s1">&#39;techniques&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">technique</span><span class="p">][</span><span class="s1">&#39;ark&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># Ajouter la technique et la liste d&#39;ARK dans le dictionnaire</span>
    <span class="n">technique_ark</span><span class="p">[</span><span class="n">technique</span><span class="p">]</span> <span class="o">=</span> <span class="n">arks</span>
<span class="n">technique_ark</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;plume&#39;: [&#39;btv1b103197173&#39;,
  &#39;btv1b10319720c&#39;,
  &#39;btv1b103205771&#39;,
  &#39;btv1b10319696k&#39;,
  &#39;btv1b10320569h&#39;,
  &#39;btv1b10319721t&#39;,
  &#39;btv1b10319747b&#39;,
  &#39;btv1b103205754&#39;,
  &#39;btv1b103197423&#39;,
  &#39;btv1b10320571b&#39;,
  &#39;btv1b103197245&#39;,
  &#39;btv1b103205737&#39;,
  &#39;btv1b103197228&#39;,
  &#39;btv1b103196954&#39;,
  &#39;btv1b103205682&#39;,
  &#39;btv1b10320583n&#39;,
  &#39;btv1b10320565q&#39;,
  &#39;btv1b10320579x&#39;,
  &#39;btv1b103197190&#39;,
  &#39;btv1b10320570w&#39;,
  &#39;btv1b10320605m&#39;,
  &#39;btv1b10320567m&#39;,
  &#39;btv1b10320608z&#39;,
  &#39;btv1b10319718j&#39;,
  &#39;btv1b10319725m&#39;,
  &#39;btv1b10320585j&#39;,
  &#39;btv1b10319723q&#39;,
  &#39;btv1b103197262&#39;,
  &#39;btv1b103205826&#39;,
  &#39;btv1b103206045&#39;,
  &#39;btv1b10319716n&#39;,
  &#39;btv1b103205665&#39;,
  &#39;btv1b10320578g&#39;,
  &#39;btv1b10320576k&#39;,
  &#39;btv1b10320572s&#39;,
  &#39;btv1b10320581r&#39;,
  &#39;btv1b10320574p&#39;,
  &#39;btv1b103197497&#39;,
  &#39;btv1b10319743j&#39;,
  &#39;btv1b10319748s&#39;,
  &#39;btv1b103205809&#39;],
 &#39;encre&#39;: [&#39;btv1b10322340k&#39;]}
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Créer un dictionnaire qui a pour clée un &#39;ark&#39; </span>
<span class="sd">et pour valeur un tuple (titre, techniques, nombre d&#39;image pour le document)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">ark_title_techniques</span> <span class="o">=</span> <span class="p">{</span><span class="n">ark</span><span class="p">:</span> <span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">ark</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span><span class="n">technique</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">ark</span><span class="p">)</span><span class="o">.</span><span class="n">images</span><span class="p">))</span> 
                        <span class="k">for</span> <span class="n">technique</span><span class="p">,</span> <span class="n">ark_list</span> <span class="ow">in</span> <span class="n">technique_ark</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> 
                        <span class="k">for</span> <span class="n">ark</span> <span class="ow">in</span> <span class="n">ark_list</span><span class="p">}</span>
<span class="n">ark_title_techniques</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;btv1b103197173&#39;: ([&#39;[La Vie en province] : [estampe] ([État avant la lettre]) / [Gustave Doré]&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319720c&#39;: ([&#39;[Promenades aux Tuileries] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103205771&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319696k&#39;: ([&#39;[Grotesques] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320569h&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319721t&#39;: ([&#39;[Les Collégiens] : [estampe] ([État avant la lettre]) / [Gustave Doré]&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319747b&#39;: ([&#39;[Grotesques] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103205754&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103197423&#39;: ([&#39;[Grotesques] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320571b&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103197245&#39;: ([&#39;[Grotesques : Promenade dans les Champs-Elysées] : [estampe] ([État avant la lettre]) / [Gustave Doré]&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103205737&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103197228&#39;: ([&#39;[Promenades dans Paris] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103196954&#39;: ([&#39;[Grotesques] : [estampe] ([État avant la lettre]) / Gustave Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103205682&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320583n&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320565q&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320579x&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103197190&#39;: ([&#39;[Internes et externes] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320570w&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320605m&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320567m&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320608z&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319718j&#39;: ([&#39;[Internes et externes] : [estampe] ([État avant la lettre]) / [Gustave Doré]&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319725m&#39;: ([&#39;[Encore les Collégiens] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320585j&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319723q&#39;: ([&#39;[Grotesques] : [estampe] ([État avant la lettre]) / Gustave Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103197262&#39;: ([&#39;[La Vie à la campagne] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103205826&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103206045&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319716n&#39;: ([&quot;[Histoire d&#39;une invitation à la campagne] : [estampe] ([État avant la lettre]) / G. Doré&quot;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103205665&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320578g&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320576k&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320572s&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320581r&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10320574p&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103197497&#39;: ([&quot;[La Vie en province : Plaisirs d&#39;une petite ville] : [estampe] ([État avant la lettre]) / G. Doré&quot;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319743j&#39;: ([&#39;[Grotesques] : [estampe] ([État avant la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10319748s&#39;: ([&quot;[La Vie en province : Plaisirs d&#39;une petite ville] : [estampe] ([État avant la lettre]) / G. Doré&quot;],
  &#39;plume&#39;,
  1),
 &#39;btv1b103205809&#39;: ([&#39;[Planche de : Doré, Gustave, &quot;Les travaux d\&#39;Hercule&quot;] : [estampe] ([Tiré à part avec la lettre]) / G. Doré&#39;],
  &#39;plume&#39;,
  1),
 &#39;btv1b10322340k&#39;: ([&#39;[Frontispice, fumé pour l\&#39;illustration de : Rabelais, François, &quot;Oeuvres&quot;, Tome 1] : [estampe] ([Fumé]) / G. Doré ; Jonnard&#39;],
  &#39;encre&#39;,
  1)}
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Prend un certain temps avant de visualiser les résultats (le temps de requêter toutes les images)</span>

<span class="n">scale</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">num_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ark_title_techniques</span><span class="p">)</span>  <span class="c1"># Nombre total d&#39;images</span>

<span class="c1"># Calcul du nombre de lignes et de colonnes pour la grille de sous-graphiques</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num_images</span><span class="p">)))</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_images</span> <span class="o">/</span> <span class="n">num_rows</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ark</span><span class="p">,</span> <span class="n">tuples</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ark_title_techniques</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="c1"># (tips) IIIF limite le téléchargement répéter d&#39;image dont la taille est supérieur à 50%</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">ark</span><span class="p">)</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;full/full/0/native.jpg&#39;</span><span class="p">,</span><span class="s1">&#39;full/pct:30/0/native.jpg&#39;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">img_rgb</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">gray2rgb</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">img</span>

    <span class="c1"># Ajout de l&#39;image au sous-graphique correspondant</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="n">num_cols</span><span class="p">]</span>  <span class="c1"># Sélection du sous-graphique</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_rgb</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tuples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">ark</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="c1"># Suppression des sous-graphiques vides (s&#39;il en reste)</span>
<span class="k">if</span> <span class="n">num_images</span> <span class="o">&lt;</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">num_cols</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">,</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">num_cols</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Ajustement automatique des espacements</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Estampes et techniques en lien avec l&#39;expression {Gustave Doré} pour les années (1832,1855,1860,1873,1883) dans Gallica Images&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/062d86b4b29af6f7d89b38c7b510e3dd4a3ce906969b09c5738f6c799df05140.png" src="../../_images/062d86b4b29af6f7d89b38c7b510e3dd4a3ce906969b09c5738f6c799df05140.png" />
</div>
</div>
<section id="collecte-des-images-via-un-csv">
<h3>Collecte des images via un <code class="docutils literal notranslate"><span class="pre">.csv</span></code><a class="headerlink" href="#collecte-des-images-via-un-csv" title="Permalink to this heading">#</a></h3>
<p>Il est possible de télécharger l’ensemble des images via un <code class="docutils literal notranslate"><span class="pre">.csv</span></code> exporté avec Pandas. Le module <code class="docutils literal notranslate"><span class="pre">iiif_from_csv()</span></code> dispose également d’un dictionnaire qui attribut des <em>form</em> IIIF par défaut à l’instart de <a class="reference internal" href="#docparams-dft"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">fetch_image()</span></code></span></a> présent dans la classe <code class="docutils literal notranslate"><span class="pre">Document</span></code> mais également un dictionnaire pour le <code class="docutils literal notranslate"><span class="pre">leaky_bucket</span></code>. La différence avec <code class="docutils literal notranslate"><span class="pre">fetch_images()</span></code> et que ce dernier est rattaché à l’ark qui a été instancié via la classe <code class="docutils literal notranslate"><span class="pre">Document</span></code> contrairement a <code class="docutils literal notranslate"><span class="pre">iiif_from_csv()</span></code> qui permet la collecte d’images appartenant a plusieurs documents.</p>
<div class="mermaid">
            stateDiagram-v2
direction TB

state client_timeout{


concurrents_manifest--&gt;seconds_manifest :window
seconds_manifest--&gt;concurrents_manifest :allows
concurrents_manifest--&gt; get_manifest_timeout : authorize

state get_manifest_timeout{
[*] --&gt; manifest.json
manifest.json  --&gt; get_img_timeout : len(img)
}
	concurrents_img--&gt;seconds_img :window
	seconds_img--&gt;concurrents_img :allows

	concurrents_img--&gt; get_img_timeout : authorize
	
	f(n)/(ark)/(region)/(size)/(rotation)/(quality)/.()extension --&gt; img :chunksize
	
	state get_img_timeout {
	[*] --&gt;f(n)/(ark)/(region)/(size)/(rotation)/(quality)/.()extension
	f(n)/(ark)/(region)/(size)/(rotation)/(quality)/.()extension
	}
}
        </div><div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default_img</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;name&#39;: &#39;202306121912&#39;,
 &#39;image&#39;: False,
 &#39;region&#39;: &#39;full&#39;,
 &#39;size&#39;: &#39;pct:50&#39;,
 &#39;rotation&#39;: &#39;0&#39;,
 &#39;quality&#39;: &#39;native&#39;,
 &#39;extension&#39;: &#39;jpg&#39;}
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">leaky_bucket_layer</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;concurrents_manifest&#39;: 50,
 &#39;seconds_manifest&#39;: 60,
 &#39;concurrents_img&#39;: 20,
 &#39;seconds_img&#39;: 60,
 &#39;chunksize&#39;: 1024,
 &#39;client_timeout&#39;: 60,
 &#39;get_manifest_timeout&#39;: 60,
 &#39;get_img_timeout&#39;: 60}
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Création d&#39;un dictionnaire vide avec les &#39;form&#39; du protocole IIIF.</span>
<span class="sd">Insère une liste d&#39;ark et des valeurs par défaut.</span>
<span class="sd">L&#39;ensemble des documents ne comporte qu&#39;une image nous le savons car chaque tuple dans &#39;ark_title_techniques&#39; tuples[2] nous renvoit &quot;1&quot;</span>
<span class="sd">Nous allons donc remplir la colonne image par &#39;f1&#39;, mais nous aurions très bien pu remplir la colonne par une liste d&#39;images ou bien tout simplement</span>
<span class="sd">ne pas la considérer dans le dictionnaire.</span>

<span class="sd">Note: il est important de séparer les valeurs présent à l&#39;intérieur d&#39;une cellule par le séparateur (&#39;/&#39;).</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ark&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">ark_title_techniques</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">tuples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ark</span><span class="p">,</span><span class="n">tuples</span> <span class="ow">in</span> <span class="n">ark_title_techniques</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
    <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;pct:30&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rotation&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span>
    <span class="s1">&#39;extension&#39;</span><span class="p">:</span> <span class="s1">&#39;jpg&#39;</span>
<span class="p">}</span>

<span class="c1">#Créer un DataFrame basé sur le dictionnaire</span>
<span class="n">df_iiif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="n">df_iiif</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>name</th>
      <th>image</th>
      <th>region</th>
      <th>size</th>
      <th>rotation</th>
      <th>quality</th>
      <th>extension</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>btv1b103197173</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>1</th>
      <td>btv1b10319720c</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>2</th>
      <td>btv1b103205771</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>3</th>
      <td>btv1b10319696k</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>4</th>
      <td>btv1b10320569h</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>5</th>
      <td>btv1b10319721t</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>6</th>
      <td>btv1b10319747b</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>7</th>
      <td>btv1b103205754</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>8</th>
      <td>btv1b103197423</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>9</th>
      <td>btv1b10320571b</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>10</th>
      <td>btv1b103197245</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>11</th>
      <td>btv1b103205737</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>12</th>
      <td>btv1b103197228</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>13</th>
      <td>btv1b103196954</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>14</th>
      <td>btv1b103205682</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>15</th>
      <td>btv1b10320583n</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>16</th>
      <td>btv1b10320565q</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>17</th>
      <td>btv1b10320579x</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>18</th>
      <td>btv1b103197190</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>19</th>
      <td>btv1b10320570w</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>20</th>
      <td>btv1b10320605m</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>21</th>
      <td>btv1b10320567m</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>22</th>
      <td>btv1b10320608z</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>23</th>
      <td>btv1b10319718j</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>24</th>
      <td>btv1b10319725m</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>25</th>
      <td>btv1b10320585j</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>26</th>
      <td>btv1b10319723q</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>27</th>
      <td>btv1b103197262</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>28</th>
      <td>btv1b103205826</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>29</th>
      <td>btv1b103206045</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>30</th>
      <td>btv1b10319716n</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>31</th>
      <td>btv1b103205665</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>32</th>
      <td>btv1b10320578g</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>33</th>
      <td>btv1b10320576k</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>34</th>
      <td>btv1b10320572s</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>35</th>
      <td>btv1b10320581r</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>36</th>
      <td>btv1b10320574p</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>37</th>
      <td>btv1b103197497</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>38</th>
      <td>btv1b10319743j</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>39</th>
      <td>btv1b10319748s</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>40</th>
      <td>btv1b103205809</td>
      <td>plume</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
    <tr>
      <th>41</th>
      <td>btv1b10322340k</td>
      <td>encre</td>
      <td>f1</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</details>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Créer un csv à partir du DataFrame</span>
<span class="n">df_iiif</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/csv/gustave_dore_techniques_from_5topdate.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#Collecte les images à partir du csv</span>
<span class="n">collecting_images</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;data/csv/gustave_dore_techniques_from_5topdate.csv&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./data/img/gustave_dore_from_5topdate/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Imaginons qu&#39;un document contient un ensemble d&#39;images et que nous aimerions récupérer des images en particulier</span>
<span class="c1">#Ici nous créons une fonction qui prend un &#39;ark&#39; comme argument et retourne un nombre aléatoire d&#39;images (la moitié des images que le document dispose)</span>
<span class="n">random_images</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ark</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;f</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">ark</span><span class="p">)</span><span class="o">.</span><span class="n">images</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span><span class="nb">len</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">ark</span><span class="p">)</span><span class="o">.</span><span class="n">images</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> 
                                          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">ark</span><span class="p">)</span><span class="o">.</span><span class="n">images</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">ark</span><span class="p">)</span><span class="o">.</span><span class="n">images</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ici un document qui contient plusieurs images</span>
<span class="n">Document</span><span class="p">(</span><span class="s1">&#39;bpt6k62463369&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">images</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f1/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f2/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f3/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f4/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f5/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f6/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f7/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f8/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f9/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f10/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f11/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f12/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f13/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f14/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f15/full/full/0/native.jpg&#39;,
 &#39;https://gallica.bnf.fr/iiif/ark:/12148/bpt6k62463369/f16/full/full/0/native.jpg&#39;]
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container" id="namefordoc">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Regex et built_in fonction pour normaliser le titre du document</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s]+&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">Document</span><span class="p">(</span><span class="s1">&#39;bpt6k62463369&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> 
<span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ark&#39;</span><span class="p">:</span> <span class="s1">&#39;bpt6k62463369&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
    <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;pct:30&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rotation&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span>
    <span class="s1">&#39;extension&#39;</span><span class="p">:</span> <span class="s1">&#39;jpg&#39;</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ark&#39;: &#39;bpt6k62463369&#39;, &#39;name&#39;: &#39;lerire_journalhumoristique&#39;, &#39;image&#39;: False, &#39;region&#39;: &#39;full&#39;, &#39;size&#39;: &#39;pct:30&#39;, &#39;rotation&#39;: 0, &#39;quality&#39;: &#39;native&#39;, &#39;extension&#39;: &#39;jpg&#39;}
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Ici la chose importante à remarquer est que le séparateur de champs est (&#39;/&#39;).</span>
<span class="sd">Il est possible de passer également un ensemble de valeurs pour les autres colonnes à condition que leurs nombres soient tous égaux entre eux.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">df_iiif2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">obj</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_iiif2</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_images</span><span class="p">(</span><span class="s1">&#39;bpt6k62463369&#39;</span><span class="p">)</span>
<span class="n">df_iiif2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ark</th>
      <th>name</th>
      <th>image</th>
      <th>region</th>
      <th>size</th>
      <th>rotation</th>
      <th>quality</th>
      <th>extension</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bpt6k62463369</td>
      <td>lerire_journalhumoristique</td>
      <td>f1/f5/f16/f2/f15/f4/f13/f6</td>
      <td>full</td>
      <td>pct:30</td>
      <td>0</td>
      <td>native</td>
      <td>jpg</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Créer un csv à partir du DataFrame</span>
<span class="n">df_iiif2</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/csv/lerire_journalhumoristique.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#Collecte les images à partir du csv</span>
<span class="n">collecting_images</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;data/csv/lerire_journalhumoristique.csv&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;./data/img/lerire_journalhumoristique&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "label-studio"
        },
        kernelOptions: {
            name: "label-studio",
            path: "./book/notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'label-studio'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="labelstudio.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Guide de pratique pour Label Studio</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../markdown/memoire.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Mémoire digitale: les enjeux de l’archive numérique et du Big Data</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Pipeline de collecte des données</a><ul>
<li><a class="reference internal" href="#les-entrepots-de-la-bnf">Les entrepôts de la BnF</a><ul>
<li><a class="reference internal" href="#la-collecte-de-metadonnees-a-travers-oai-py">La collecte de métadonnées à travers <code class="docutils literal notranslate"><span class="pre">oai.py</span></code></a></li>
<li><a class="reference internal" href="#creation-d-un-parser">Création d’un <em>parser</em></a></li>
<li><a class="reference internal" href="#collecte-de-sets-present-dans-l-entrepot">Collecte de sets présent dans l’entrepôt</a></li>
<li><a class="reference internal" href="#collecte-des-images-a-travers-document-py">Collecte des images à travers <code class="docutils literal notranslate"><span class="pre">document.py</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#fouille-de-donnee-research-multiprocessing-py">Fouille de donnée <code class="docutils literal notranslate"><span class="pre">research_multiprocessing.py</span></code></a><ul>
<li><a class="reference internal" href="#collecte-des-images-via-un-csv">Collecte des images via un <code class="docutils literal notranslate"><span class="pre">.csv</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>